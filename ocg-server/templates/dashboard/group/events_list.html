{% import "macros/badges.html" as badges -%}
{% import "macros/dashboard.html" as dashboard -%}
{% import "macros/pagination.html" as pagination -%}

{# Events list header with title -#}
<div class="flex justify-between mb-10">
  {{ dashboard::form_title(title = "Events") -}}

  {# Add event button -#}
  <div>
    <button id="add-event-button"
            hx-get="/dashboard/group/events/add"
            hx-target="#dashboard-content"
            hx-indicator="#dashboard-spinner"
            class="btn-primary">Add Event</button>
  </div>
  {# End add event button -#}

  <script type="module">
    const addEventButton = document.getElementById('add-event-button');
    if (addEventButton) {
      addEventButton.addEventListener('htmx:afterRequest', () => {
        try {
          history.pushState({}, "Events list", '/dashboard/group?tab=events');
        } catch (error) {
          console.warn('Failed to update browser history:', error);
        }
      });
    }
  </script>
</div>

{# Events Tabs Navigation -#}
<div class="my-10">
  <ul class="flex flex-wrap space-x-2 -mb-px text-sm font-medium text-center border-b border-stone-200">
    <li>
      <button type="button"
              id="upcoming-tab"
              data-active="{{ events_tab == EventsTab::Upcoming }}"
              hx-get="/dashboard/group/events?events_tab={{ EventsTab::Upcoming }}"
              hx-target="#dashboard-content"
              hx-swap="innerHTML show:window:top"
              hx-indicator="#dashboard-spinner"
              class="cursor-pointer inline-flex items-center justify-center p-2 sm:p-3 border-b-2 border-transparent rounded-t-lg hover:text-stone-600 hover:border-stone-300 data-[active=true]:text-primary-500 data-[active=true]:border-primary-500 text-nowrap w-40">
        Upcoming events
      </button>
    </li>
    <li>
      <button type="button"
              id="past-tab"
              data-active="{{ events_tab == EventsTab::Past }}"
              hx-get="/dashboard/group/events?events_tab={{ EventsTab::Past }}"
              hx-target="#dashboard-content"
              hx-swap="innerHTML show:window:top"
              hx-indicator="#dashboard-spinner"
              class="cursor-pointer inline-flex items-center justify-center p-2 sm:p-3 border-b-2 border-transparent rounded-t-lg hover:text-stone-600 hover:border-stone-300 data-[active=true]:text-primary-500 data-[active=true]:border-primary-500 text-nowrap w-40">
        Past events
      </button>
    </li>
  </ul>
</div>

{# Upcoming Events Section -#}
<div id="upcoming-content"
     data-events-content="upcoming"
     class="{% if events_tab == EventsTab::Past %}
              hidden
            {% endif %}">
  <div class="text-sm text-stone-600 mb-5">
    {{ pagination::range_display(offset = upcoming_offset.unwrap_or(0) , count = events.upcoming.events.len(), total = events.upcoming.total, label = "event") }}
  </div>
  <div class="relative overflow-visible">
    <table class="table-auto w-full text-xs lg:text-sm text-left rtl:text-right text-stone-500 mb-8"
           role="table"
           aria-label="Upcoming events list">
      <thead class="text-xs text-stone-700 uppercase bg-stone-100 border-b border-stone-200"
             role="rowgroup">
        {# Header -#}
        <tr>
          <th scope="col" class="px-3 xl:px-5 py-3">Name</th>
          <th scope="col" class="hidden 2xl:table-cell px-3 xl:px-5 py-3">Location</th>
          <th scope="col" class="hidden xl:table-cell px-3 xl:px-5 py-3">Date</th>
          <th scope="col" class="hidden xl:table-cell px-3 xl:px-5 py-3">Type</th>
          <th scope="col" class="px-3 xl:px-5 py-3">Status</th>
          <th scope="col" class="px-3 xl:px-5 py-3 w-27"></th>
        </tr>
      </thead>
      <tbody id="upcoming-events-list" role="rowgroup">
        {% if events.upcoming.events.is_empty() -%}
          <tr class="bg-white border-b border-stone-200">
            {# Mobile: 3 columns (Name, Status, Actions) -#}
            <td class="xl:hidden px-8 py-20 text-center" colspan="3">
              {% include "dashboard/placeholders/group_events_table.html" -%}
            </td>
            {# xl: 5 columns (adds Date, Type) -#}
            <td class="hidden xl:table-cell 2xl:hidden px-8 py-20 text-center"
                colspan="5">{% include "dashboard/placeholders/group_events_table.html" -%}</td>
            {# 2xl: 6 columns (adds Location) -#}
            <td class="hidden 2xl:table-cell px-8 py-20 text-center" colspan="6">
              {% include "dashboard/placeholders/group_events_table.html" -%}
            </td>
          </tr>
        {% else -%}
          {% for event in events.upcoming.events -%}
            <tr class="odd:bg-white even:bg-stone-50/50 border-b border-stone-200">
              <th scope="row"
                  class="px-3 xl:px-5 py-4 font-medium text-stone-900 min-w-[100px] max-w-[200px] xl:max-w-auto">
                <div class="flex items-center">
                  <div class="min-w-0">
                    {# Event name -#}
                    {% if !event.canceled -%}
                      <button hx-get="/dashboard/group/events/{{ event.event_id }}/update"
                              hx-target="#dashboard-content"
                              hx-indicator="#dashboard-spinner"
                              hx-swap="innerHTML show:body:top"
                              hx-disabled-elt="this"
                              class="block max-w-full truncate hover:underline text-left cursor-pointer bg-transparent border-0 p-0 font-medium text-stone-900"
                              aria-label="Edit event: {{ event.name }}">{{ event.name }}</button>
                    {% else -%}
                      <div class="block max-w-full truncate">{{ event.name }}</div>
                    {% endif -%}
                    {# End event name -#}

                    {# Mobile type and date -#}
                    <div class="block xl:hidden text-xs text-stone-500">
                      <div class="max-w-full truncate">{{ event.kind }}</div>
                      {% if let Some(start_time) = &event.starts_at -%}
                        <div class="max-w-full truncate">
                          {{ start_time.with_timezone(event.timezone).format("%b %d, %Y at %I:%M %p %Z") }}
                        </div>
                      {% endif -%}
                    </div>
                    {# End mobile type and date -#}
                  </div>
                </div>
              </th>

              {# Location -#}
              <td class="hidden 2xl:table-cell px-3 xl:px-5 py-4 whitespace-nowrap min-w-[100px] max-w-[200px]">
                {# TODO - fix comparison #}
                {% if event.kind.to_string() != "virtual" -%}
                  {% if let Some(location) = &event.location(90) -%}
                    <div class="max-w-full truncate">{{ location }}</div>
                  {% else -%}
                    <span class="text-stone-400">-</span>
                  {% endif -%}
                {% else -%}
                  <span class="text-stone-500">Virtual</span>
                {% endif -%}
              </td>
              {# End location -#}

              {# Date & Time -#}
              <td class="hidden xl:table-cell px-3 xl:px-5 py-4 whitespace-nowrap min-w-[150px] max-w-[200px]">
                {% if let Some(start_time) = &event.starts_at -%}
                  <div class="max-w-full truncate">{{ start_time.with_timezone(event.timezone).format("%b %d, %Y") }}</div>
                  <div class="max-w-full truncate text-xs text-stone-400">
                    {{ start_time.with_timezone(event.timezone).format("%I:%M %p %Z") }}
                  </div>
                {% else -%}
                  <span class="text-stone-400">TBD</span>
                {% endif -%}
              </td>
              {# End date & time -#}

              {# Event Type -#}
              <td class="hidden xl:table-cell px-3 xl:px-5 py-4 whitespace-nowrap min-w-[100px] max-w-[150px]">
                {{ badges::event_badge(kind = event.kind, extra_styles = Some("px-2.5 py-0.5") ) -}}
              </td>
              {# End event type -#}

              {# Status -#}
              <td class="px-3 xl:px-5 py-4 whitespace-nowrap min-w-[100px] max-w-[150px]">
                {% if event.canceled -%}
                  {{ badges::status_badge(label = "Canceled", canceled = true, published = false) -}}
                {% else if event.published -%}
                  {{ badges::status_badge(label = "Published", canceled = false, published = true) -}}
                {% else -%}
                  {{ badges::status_badge(label = "Draft", canceled = false, published = false) -}}
                {% endif -%}
              </td>
              {# End status -#}

              {# Actions -#}
              <td class="px-3 xl:px-5 py-4 w-27">
                <div class="flex items-center gap-x-1 xl:gap-x-3">
                  {# Update event button -#}
                  <div>
                    <button hx-get="/dashboard/group/events/{{ event.event_id }}/update"
                            hx-target="#dashboard-content"
                            hx-indicator="#dashboard-spinner"
                            hx-swap="innerHTML show:body:top"
                            hx-disabled-elt="this"
                            class="btn-tertiary p-2
                                   {% if event.canceled %}opacity-50 cursor-not-allowed{% endif %}"
                            {% if event.canceled %}disabled title="Event is canceled"{% endif %}
                            aria-label="Edit event: {{ event.name }}">
                      <div class="svg-icon size-4 icon-pencil"></div>
                    </button>
                  </div>
                  {# End update event button -#}

                  {# View event button -#}
                  <div>
                    {% if event.published && !event.canceled -%}
                      <a href="/{{ event.community_name }}/group/{{ event.group_slug }}/event/{{ event.slug }}"
                         target="_blank"
                         rel="noopener noreferrer"
                         class="btn-tertiary p-2 inline-flex items-center justify-center"
                         aria-label="View event page: {{ event.name }}">
                        <div class="svg-icon size-4 icon-eye"></div>
                      </a>
                    {% else -%}
                      <button disabled
                              class="btn-tertiary p-2 inline-flex items-center justify-center opacity-50 cursor-not-allowed"
                              title="Event must be published and not canceled"
                              aria-label="View event page: {{ event.name }}">
                        <div class="svg-icon size-4 icon-eye"></div>
                      </button>
                    {% endif -%}
                  </div>
                  {# End view event button -#}

                  <div class="group relative">
                    <button data-event-id="{{ event.event_id }}"
                            class="btn-actions btn-tertiary p-2 group-has-[.dropdown:not(.hidden)]:bg-stone-50">
                      <div class="svg-icon size-4 icon-vertical-dots"></div>
                    </button>

                    {# Dropdown actions -#}
                    <div id="dropdown-actions-{{ event.event_id }}"
                         class="dropdown absolute hidden z-10 end-0 top-8 w-[200px] bg-white divide-y divide-stone-100 rounded-lg shadow border border-stone-200">
                      <ul class="py-2 text-sm text-stone-700"
                          aria-labelledby="dropdownDefaultButton">
                        {# Publish/Unpublish button depending on status -#}
                        {% if event.published && !event.canceled -%}
                          <li>
                            <button id="unpublish-event-{{ event.event_id }}"
                                    hx-put="/dashboard/group/events/{{ event.event_id }}/unpublish"
                                    hx-target="#dashboard-content"
                                    hx-indicator="#dashboard-spinner"
                                    hx-trigger="confirmed"
                                    class="cursor-pointer w-full text-start px-4 py-2 hover:bg-stone-100">
                              <div class="flex items-center">
                                <div class="svg-icon size-4 icon-power bg-stone-600"></div>
                                <div class="ms-2">Unpublish</div>
                              </div>
                            </button>
                            <script type="module">
                              import {
                                showConfirmAlert,
                                handleHtmxResponse,
                              } from '/static/js/common/alerts.js';

                              const unpublishEventButton = document.getElementById('unpublish-event-{{ event.event_id }}');
                              if (unpublishEventButton) {
                                unpublishEventButton.addEventListener('click', () => {
                                  showConfirmAlert("Are you sure you wish to unpublish this event?", "unpublish-event-{{ event.event_id }}", "Yes");
                                });

                                unpublishEventButton.addEventListener("htmx:afterRequest", (e) => {
                                  const xhr = e.detail?.xhr;
                                  handleHtmxResponse({
                                    xhr,
                                    successMessage: "You have successfully unpublished the event.",
                                    errorMessage: "An error occurred unpublishing this event. Please try again later."
                                  });
                                });
                              }
                            </script>
                          </li>
                        {% elif !event.canceled -%}
                          <li>
                            <button id="publish-event-{{ event.event_id }}"
                                    hx-put="/dashboard/group/events/{{ event.event_id }}/publish"
                                    hx-target="#dashboard-content"
                                    hx-indicator="#dashboard-spinner"
                                    hx-trigger="confirmed"
                                    class="cursor-pointer w-full text-start px-4 py-2 hover:bg-stone-100">
                              <div class="flex items-center">
                                <div class="svg-icon size-4 icon-check bg-stone-600"></div>
                                <div class="ms-2">Publish</div>
                              </div>
                            </button>
                            <script type="module">
                              import {
                                showConfirmAlert,
                                handleHtmxResponse,
                              } from '/static/js/common/alerts.js';

                              const publishEventButton = document.getElementById('publish-event-{{ event.event_id }}');
                              if (publishEventButton) {
                                publishEventButton.addEventListener('click', () => {
                                  showConfirmAlert("Are you sure you wish to publish this event?", "publish-event-{{ event.event_id }}", "Yes");
                                });

                                publishEventButton.addEventListener("htmx:afterRequest", (e) => {
                                  const xhr = e.detail?.xhr;
                                  handleHtmxResponse({
                                    xhr,
                                    successMessage: "You have successfully published the event.",
                                    errorMessage: "An error occurred publishing this event. Please try again later."
                                  });
                                });
                              }
                            </script>
                          </li>
                        {% endif -%}
                        {# End publish/unpublish button -#}
                        {# Cancel button -#}
                        {% if !event.canceled -%}
                          <li>
                            <button id="cancel-event-{{ event.event_id }}"
                                    hx-put="/dashboard/group/events/{{ event.event_id }}/cancel"
                                    hx-target="#dashboard-content"
                                    hx-indicator="#dashboard-spinner"
                                    hx-trigger="confirmed"
                                    class="cursor-pointer w-full text-start px-4 py-2 hover:bg-stone-100">
                              <div class="flex items-center">
                                <div class="svg-icon size-4 icon-cancel bg-stone-600"></div>
                                <div class="ms-2">Cancel</div>
                              </div>
                            </button>
                            <script type="module">
                              import {
                                showConfirmAlert,
                                handleHtmxResponse,
                              } from '/static/js/common/alerts.js';

                              const cancelEventButton = document.getElementById('cancel-event-{{ event.event_id }}');
                              if (cancelEventButton) {
                                cancelEventButton.addEventListener('click', (event) => {
                                  showConfirmAlert("Are you sure you wish to cancel this event? This action is not reversible.", "cancel-event-{{ event.event_id }}", "Yes");
                                });

                                cancelEventButton.addEventListener("htmx:afterRequest", (e) => {
                                  const xhr = e.detail?.xhr;
                                  handleHtmxResponse({
                                    xhr,
                                    successMessage: "You have successfully canceled the event.",
                                    errorMessage: "Something went wrong canceling this event. Please try again later."
                                  });
                                });
                              }
                            </script>
                          </li>
                        {% endif -%}
                        {# End cancel button -#}
                        {# Delete button -#}
                        <li>
                          <button id="delete-event-{{ event.event_id }}"
                                  hx-delete="/dashboard/group/events/{{ event.event_id }}/delete"
                                  hx-target="#dashboard-content"
                                  hx-indicator="#dashboard-spinner"
                                  hx-trigger="confirmed"
                                  class="cursor-pointer w-full text-start px-4 py-2 hover:bg-stone-100">
                            <div class="flex items-center">
                              <div class="svg-icon size-4 icon-trash bg-stone-600"></div>
                              <div class="ms-2">Delete</div>
                            </div>
                          </button>
                          <script type="module">
                            import {
                              showConfirmAlert,
                              handleHtmxResponse,
                            } from '/static/js/common/alerts.js';

                            (() => {
                              const deleteEventButton = document.getElementById('delete-event-{{ event.event_id }}');
                              if (deleteEventButton) {
                                deleteEventButton.addEventListener('click', () => {
                                  showConfirmAlert(
                                    "Are you sure you wish to delete this event?",
                                    "delete-event-{{ event.event_id }}",
                                    "Yes"
                                  );
                                });

                                deleteEventButton.addEventListener("htmx:afterRequest", (e) => {
                                  const xhr = e.detail?.xhr;
                                  handleHtmxResponse({
                                    xhr,
                                    successMessage: "You have successfully deleted the event.",
                                    errorMessage: "Something went wrong deleting this event. Please try again later."
                                  });
                                });
                              }
                            })();
                          </script>
                        </li>
                        {# End delete button -#}
                      </ul>
                    </div>
                    {# End dropdown actions -#}
                  </div>
                </div>
              </td>
              {# End actions -#}
            </tr>
          {% endfor -%}
        {% endif -%}
      </tbody>
    </table>
  </div>
  {# Pagination -#}
  {% if events.upcoming.total > events.upcoming.events.len() -%}
    {{ pagination::navigation_links(links = upcoming_navigation_links, hx_target = "#dashboard-content", hx_indicator = "#dashboard-spinner") }}
  {% endif -%}
  {# End pagination -#}
</div>
{# End Upcoming Events Section -#}

{# Past Events Section -#}
<div id="past-content"
     data-events-content="past"
     class="{% if events_tab == EventsTab::Upcoming %}
              hidden
            {% endif %}">
  <div class="text-sm text-stone-600 mb-5">
    {{ pagination::range_display(offset = past_offset.unwrap_or(0) , count = events.past.events.len(), total = events.past.total, label = "event") }}
  </div>
  <div class="relative overflow-visible">
    <table class="table-auto w-full text-xs lg:text-sm text-left rtl:text-right text-stone-500 mb-8"
           role="table"
           aria-label="Past events list">
      <thead class="text-xs text-stone-700 uppercase bg-stone-100 border-b border-stone-200"
             role="rowgroup">
        {# Header -#}
        <tr>
          <th scope="col" class="px-3 xl:px-5 py-3">Name</th>
          <th scope="col" class="hidden 2xl:table-cell px-3 xl:px-5 py-3">Location</th>
          <th scope="col" class="hidden xl:table-cell px-3 xl:px-5 py-3">Date</th>
          <th scope="col" class="hidden xl:table-cell px-3 xl:px-5 py-3">Type</th>
          <th scope="col" class="px-3 xl:px-5 py-3">Status</th>
          <th scope="col" class="px-3 xl:px-5 py-3 w-27"></th>
        </tr>
      </thead>
      <tbody id="past-events-list" role="rowgroup">
        {% if events.past.events.is_empty() -%}
          <tr class="bg-white border-b border-stone-200">
            {# Mobile: 3 columns (Name, Status, Actions) -#}
            <td class="xl:hidden px-8 py-20 text-center" colspan="3">
              {% include "dashboard/placeholders/events_past.html" -%}
            </td>
            {# xl: 5 columns (adds Date, Type) -#}
            <td class="hidden xl:table-cell 2xl:hidden px-8 py-20 text-center"
                colspan="5">{% include "dashboard/placeholders/events_past.html" -%}</td>
            {# 2xl: 6 columns (adds Location) -#}
            <td class="hidden 2xl:table-cell px-8 py-20 text-center" colspan="6">
              {% include "dashboard/placeholders/events_past.html" -%}
            </td>
          </tr>
        {% else -%}
          {% for event in events.past.events -%}
            <tr class="odd:bg-white even:bg-stone-50/50 border-b border-stone-200">
              <th scope="row"
                  class="px-3 xl:px-5 py-4 font-medium text-stone-900 min-w-[100px] max-w-[200px] xl:max-w-auto">
                <div class="flex items-center">
                  <div class="min-w-0">
                    {# Event name -#}
                    {% if !event.canceled -%}
                      <button hx-get="/dashboard/group/events/{{ event.event_id }}/update"
                              hx-target="#dashboard-content"
                              hx-indicator="#dashboard-spinner"
                              hx-swap="innerHTML show:body:top"
                              hx-disabled-elt="this"
                              class="block max-w-full truncate hover:underline text-left cursor-pointer bg-transparent border-0 p-0 font-medium text-stone-900"
                              aria-label="Edit event: {{ event.name }}">{{ event.name }}</button>
                    {% else -%}
                      <div class="block max-w-full truncate">{{ event.name }}</div>
                    {% endif -%}
                    {# End event name -#}

                    {# Mobile type and date -#}
                    <div class="block xl:hidden text-xs text-stone-500">
                      <div class="max-w-full truncate">{{ event.kind }}</div>
                      {% if let Some(start_time) = &event.starts_at -%}
                        <div class="max-w-full truncate">
                          {{ start_time.with_timezone(event.timezone).format("%b %d, %Y at %I:%M %p %Z") }}
                        </div>
                      {% endif -%}
                    </div>
                    {# End mobile type and date -#}
                  </div>
                </div>
              </th>

              {# Location -#}
              <td class="hidden 2xl:table-cell px-3 xl:px-5 py-4 whitespace-nowrap min-w-[100px] max-w-[200px]">
                {# TODO - fix comparison #}
                {% if event.kind.to_string() != "virtual" -%}
                  {% if let Some(location) = &event.location(90) -%}
                    <div class="max-w-full truncate">{{ location }}</div>
                  {% else -%}
                    <span class="text-stone-400">-</span>
                  {% endif -%}
                {% else -%}
                  <span class="text-stone-500">Virtual</span>
                {% endif -%}
              </td>
              {# End location -#}

              {# Date & Time -#}
              <td class="hidden xl:table-cell px-3 xl:px-5 py-4 whitespace-nowrap min-w-[150px] max-w-[200px]">
                {% if let Some(start_time) = &event.starts_at -%}
                  <div class="max-w-full truncate">{{ start_time.with_timezone(event.timezone).format("%b %d, %Y") }}</div>
                  <div class="max-w-full truncate text-xs text-stone-400">
                    {{ start_time.with_timezone(event.timezone).format("%I:%M %p %Z") }}
                  </div>
                {% else -%}
                  <span class="text-stone-400">TBD</span>
                {% endif -%}
              </td>
              {# End date & time -#}

              {# Event Type -#}
              <td class="hidden xl:table-cell px-3 xl:px-5 py-4 whitespace-nowrap min-w-[100px] max-w-[150px]">
                {{ badges::event_badge(kind = event.kind, extra_styles = Some("px-2.5 py-0.5") ) -}}
              </td>
              {# End event type -#}

              {# Status -#}
              <td class="px-3 xl:px-5 py-4 whitespace-nowrap min-w-[100px] max-w-[150px]">
                {% if event.canceled -%}
                  {{ badges::status_badge(label = "Canceled", canceled = true, published = false) -}}
                {% else if event.published -%}
                  {{ badges::status_badge(label = "Published", canceled = false, published = true) -}}
                {% else -%}
                  {{ badges::status_badge(label = "Draft", canceled = false, published = false) -}}
                {% endif -%}
              </td>
              {# End status -#}

              {# Actions -#}
              <td class="px-3 xl:px-5 py-4 w-27">
                <div class="flex items-center gap-x-1 xl:gap-x-3">
                  {# Update event button -#}
                  <div>
                    <button hx-get="/dashboard/group/events/{{ event.event_id }}/update"
                            hx-target="#dashboard-content"
                            hx-indicator="#dashboard-spinner"
                            hx-swap="innerHTML show:body:top"
                            hx-disabled-elt="this"
                            class="btn-tertiary p-2
                                   {% if event.canceled %}opacity-50 cursor-not-allowed{% endif %}"
                            {% if event.canceled %}disabled title="Event is canceled"{% endif %}
                            aria-label="Edit event: {{ event.name }}">
                      <div class="svg-icon size-4 icon-pencil"></div>
                    </button>
                  </div>
                  {# End update event button -#}

                  {# View event button -#}
                  <div>
                    {% if event.published && !event.canceled -%}
                      <a href="/{{ event.community_name }}/group/{{ event.group_slug }}/event/{{ event.slug }}"
                         target="_blank"
                         rel="noopener noreferrer"
                         class="btn-tertiary-anchor p-2 inline-flex items-center justify-center"
                         aria-label="View event page: {{ event.name }}">
                        <div class="svg-icon size-4 icon-eye"></div>
                      </a>
                    {% else -%}
                      <button disabled
                              class="btn-tertiary p-2 inline-flex items-center justify-center opacity-50 cursor-not-allowed"
                              title="Event must be published and not canceled"
                              aria-label="View event page: {{ event.name }}">
                        <div class="svg-icon size-4 icon-eye"></div>
                      </button>
                    {% endif -%}
                  </div>
                  {# End view event button -#}

                  <div class="group relative">
                    <button data-event-id="{{ event.event_id }}"
                            class="btn-actions btn-tertiary p-2 group-has-[.dropdown:not(.hidden)]:bg-stone-50">
                      <div class="svg-icon size-4 icon-vertical-dots"></div>
                    </button>

                    {# Dropdown actions -#}
                    <div id="dropdown-actions-{{ event.event_id }}"
                         class="dropdown absolute hidden z-10 end-0 top-8 w-[200px] bg-white divide-y divide-stone-100 rounded-lg shadow border border-stone-200">
                      <ul class="py-2 text-sm text-stone-700"
                          aria-labelledby="dropdownDefaultButton">
                        {# Delete button -#}
                        <li>
                          <button id="delete-event-{{ event.event_id }}"
                                  hx-delete="/dashboard/group/events/{{ event.event_id }}/delete"
                                  hx-target="#dashboard-content"
                                  hx-indicator="#dashboard-spinner"
                                  hx-trigger="confirmed"
                                  class="cursor-pointer w-full text-start px-4 py-2 hover:bg-stone-100">
                            <div class="flex items-center">
                              <div class="svg-icon size-4 icon-trash bg-stone-600"></div>
                              <div class="ms-2">Delete</div>
                            </div>
                          </button>
                          <script type="module">
                            import {
                              showConfirmAlert,
                              handleHtmxResponse,
                            } from '/static/js/common/alerts.js';

                            (() => {
                              const deleteEventButton = document.getElementById('delete-event-{{ event.event_id }}');
                              if (deleteEventButton) {
                                deleteEventButton.addEventListener('click', () => {
                                  showConfirmAlert(
                                    "Are you sure you wish to delete this event?",
                                    "delete-event-{{ event.event_id }}",
                                    "Yes"
                                  );
                                });

                                deleteEventButton.addEventListener("htmx:afterRequest", (e) => {
                                  const xhr = e.detail?.xhr;
                                  handleHtmxResponse({
                                    xhr,
                                    successMessage: "You have successfully deleted the event.",
                                    errorMessage: "Something went wrong deleting this event. Please try again later."
                                  });
                                });
                              }
                            })();
                          </script>
                        </li>
                        {# End delete button -#}
                      </ul>
                    </div>
                    {# End dropdown actions -#}
                  </div>
                </div>
              </td>
              {# End actions -#}
            </tr>
          {% endfor -%}
        {% endif -%}
      </tbody>
    </table>
  </div>

  {# Pagination -#}
  {% if events.past.total > events.past.events.len() -%}
    {{ pagination::navigation_links(links = past_navigation_links, hx_target = "#dashboard-content", hx_indicator = "#dashboard-spinner") }}
  {% endif -%}
  {# End pagination -#}
</div>
{# End Past Events Section -#}

<script type="module">
  const btnActions = document.querySelectorAll('.btn-actions');
  btnActions.forEach((btnAction) => {
    btnAction.addEventListener('click', () => {
      const eventId = btnAction.dataset.eventId;

      const dropdownActions = document.getElementById(`dropdown-actions-${eventId}`);
      if (dropdownActions) {
        const isOpen = dropdownActions.classList.contains('hidden');
        dropdownActions.classList.toggle('hidden');
        if (isOpen) {
          // Close dropdown actions when clicking outside
          document.addEventListener('click', (event) => {
            if (!dropdownActions.contains(event.target) && !btnAction.contains(event.target)) {
              dropdownActions.classList.add('hidden');
            }
          });
        } else {
          // Remove event listener when dropdown is closed
          document.removeEventListener('click', () => {});
        }
      }
    });
  });
</script>
