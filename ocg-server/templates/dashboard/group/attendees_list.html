{% import "common.html" as common -%}
{% import "dashboard/dashboard_macros.html" as macros -%}

{# Attendees header -#}
{% call macros::form_title(title = "Attendees") -%}

<div class="flex flex-col my-10 w-3/4 max-w-[90vw] relative">
  <label for="group-event-selector-button" class="form-label mb-2">Event</label>
  <event-selector button-id="group-event-selector-button" has-events="false"></event-selector>
</div>

<div class="flex text-sm text-stone-600 mb-3 justify-end">
  <div>Total attendees:</div>
  <div class="font-semibold ms-1 text-end w-7">
    {% if attendees.is_empty() -%}
      -
    {% else %}
      {{ attendees.len() }}
    {% endif -%}
  </div>
</div>

{# Attendees table -#}
<div class="relative overflow-visible">
  <table class="table-fixed w-full text-xs lg:text-sm text-left rtl:text-right text-stone-500"
         role="table"
         aria-label="Attendees list">
    <thead class="text-xs text-stone-700 uppercase bg-stone-100 border-b border-stone-200"
           role="rowgroup">
      <tr>
        <th scope="col" class="px-3 xl:px-5 py-3">Attendee</th>
        <th scope="col" class="px-3 xl:px-5 py-3">Position</th>
        <th scope="col" class="hidden xl:table-cell px-3 xl:px-5 py-3 w-40">RSVP Date</th>
        <th scope="col" class="px-3 xl:px-5 py-3 w-30">Checked In</th>
      </tr>
    </thead>
    <tbody id="attendees-list" role="rowgroup">
      {% if let Some(event) = event -%}
        {% if attendees.is_empty() -%}
          <tr class="bg-white border-b border-stone-200">
            <td class="px-8 py-12 text-center" colspan="4">
              <div class="flex flex-col items-center justify-center min-h-[125px]">
                <div class="text-xl lg:text-2xl mb-6">No attendees found for this event.</div>
                <p class="text-sm lg:text-md text-stone-700">Try a different event.</p>
              </div>
            </td>
          </tr>
        {% else -%}
          {% for attendee in attendees -%}
            <tr class="odd:bg-white even:bg-stone-50/50 border-b border-stone-200">
              {# Attendee -#}
              <td class="px-3 xl:px-5 py-4">
                <div class="flex items-center space-x-5">
                  <avatar-image
                  {% if let Some(photo_url) = attendee.photo_url -%}
                    image-url="{{ photo_url }}"
                  {% endif -%}
                  size="size-10" placeholder="{{ self::user_initials(attendee.name.as_deref() , attendee.username.as_str()) }}">
                  </avatar-image>
                  <div class="min-w-0">
                    <div class="font-medium text-stone-900 truncate mb-1">
                      {{ attendee.name|display_some_or(attendee.username) }}
                    </div>
                    {% if attendee.name.is_some() -%}
                      <div class="text-xs text-stone-600 truncate">{{ attendee.username }}</div>
                    {% endif -%}
                  </div>
                </div>
              </td>
              {# End attendee -#}

              {# Position -#}
              <td class="px-3 xl:px-5 py-4">
                <div class="flex flex-col space-y-1">
                  <div class="font-medium text-stone-900 truncate">{{ attendee.company|display_some_or("-") }}</div>
                  {% if let Some(title) = attendee.title -%}
                    <div class="text-xs text-stone-600 truncate">{{ title }}</div>
                  {% endif -%}
                </div>
              </td>
              {# End Position -#}

              {# RSVP Date -#}
              <td class="hidden xl:table-cell px-3 xl:px-5 py-4 whitespace-nowrap w-40">
                {{ attendee.created_at.format("%b %d, %Y") }}
              </td>
              {# End RSVP date -#}

              {# Checked In -#}
              <td class="px-3 xl:px-5 py-4 w-30">
                {% if attendee.checked_in -%}
                  <div class="svg-icon size-4 icon-check bg-primary-500"
                       aria-label="Checked in"></div>
                {% else -%}
                  <span class="text-stone-400">-</span>
                {% endif -%}
              </td>
              {# End checked in -#}
            </tr>
          {% endfor -%}
        {% endif -%}
      {% else -%}
        <tr class="bg-white border-b border-stone-200">
          <td class="px-8 py-12 text-center" colspan="4">
            <div class="flex flex-col items-center justify-center min-h-[125px]">
              <div class="text-xl lg:text-2xl mb-6">Select an event to view attendees.</div>
              <p class="text-sm lg:text-md text-stone-700">
                Use the <span class="font-semibold">Event</span> dropdown above to pick an event
                and load its attendees.
              </p>
            </div>
          </td>
        </tr>
      {% endif -%}
    </tbody>
  </table>
</div>
{# End attendees table -#}
