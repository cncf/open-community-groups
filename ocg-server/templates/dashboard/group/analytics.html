{% import "macros/dashboard.html" as dashboard -%}
{% import "macros/stats.html" as stats_macro -%}

{# Page title #}
{{ dashboard::form_title(title = "Analytics",
description = "Group statistics and growth trends. Analytics are cached for a few minutes and may not display up to date information.") }}
{# End page title #}

{# Summary stat cards #}
<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 mt-10">
  <div class="bg-white border border-stone-200 text-start rounded-lg p-5">
    <div class="text-sm text-stone-600">Members</div>
    <div class="mt-2 text-3xl font-semibold text-stone-900">{{ stats.members.total|num_fmt }}</div>
    <div class="mt-1 text-xs text-stone-500">People in this group</div>
  </div>
  <div class="bg-white border border-stone-200 text-start rounded-lg p-5">
    <div class="text-sm text-stone-600">Events</div>
    <div class="mt-2 text-3xl font-semibold text-stone-900">{{ stats.events.total|num_fmt }}</div>
    <div class="mt-1 text-xs text-stone-500">Published and past events</div>
  </div>
  <div class="bg-white border border-stone-200 text-start rounded-lg p-5">
    <div class="text-sm text-stone-600">Attendees</div>
    <div class="mt-2 text-3xl font-semibold text-stone-900">{{ stats.attendees.total|num_fmt }}</div>
    <div class="mt-1 text-xs text-stone-500">Total RSVPs</div>
  </div>
</div>
{# End summary stat cards #}

{# Charts sections #}
<div class="space-y-12 mt-10">
  <div>
    {{ dashboard::form_title(title = "Members") }}
    <div class="mt-6 grid grid-cols-1 gap-6">
      <div>
        <div class="text-sm font-semibold text-stone-500">Running total</div>
        <div class="bg-white border border-stone-200 rounded-lg p-6 mt-3">
          {{ stats_macro::analytics_chart(chart_id = "members-running-chart", data = stats.members.running_total, min_points = 1) -}}
        </div>
      </div>
      <div>
        <div class="text-sm font-semibold text-stone-500">Per month</div>
        <div class="bg-white border border-stone-200 rounded-lg p-6 mt-3">
          {{ stats_macro::analytics_chart(chart_id = "members-monthly-chart", data = stats.members.per_month) -}}
        </div>
      </div>
    </div>
  </div>

  <div>
    {{ dashboard::form_title(title = "Events") }}
    <div class="mt-6 grid grid-cols-1 gap-6">
      <div>
        <div class="text-sm font-semibold text-stone-500">Running total</div>
        <div class="bg-white border border-stone-200 rounded-lg p-6 mt-3">
          {{ stats_macro::analytics_chart(chart_id = "events-running-chart", data = stats.events.running_total, min_points = 1) -}}
        </div>
      </div>
      <div>
        <div class="text-sm font-semibold text-stone-500">Per month</div>
        <div class="bg-white border border-stone-200 rounded-lg p-6 mt-3">
          {{ stats_macro::analytics_chart(chart_id = "events-monthly-chart", data = stats.events.per_month) -}}
        </div>
      </div>
    </div>
  </div>

  <div>
    {{ dashboard::form_title(title = "Attendees") }}
    <div class="mt-6 grid grid-cols-1 gap-6">
      <div>
        <div class="text-sm font-semibold text-stone-500">Running total</div>
        <div class="bg-white border border-stone-200 rounded-lg p-6 mt-3">
          {{ stats_macro::analytics_chart(chart_id = "attendees-running-chart", data = stats.attendees.running_total, min_points = 1) -}}
        </div>
      </div>
      <div>
        <div class="text-sm font-semibold text-stone-500">Per month</div>
        <div class="bg-white border border-stone-200 rounded-lg p-6 mt-3">
          {{ stats_macro::analytics_chart(chart_id = "attendees-monthly-chart", data = stats.attendees.per_month) -}}
        </div>
      </div>
    </div>
  </div>
</div>
{# End charts sections #}

{# Initialize charts with server data #}
{# djlint:off #}
<script type="module">
  import { initAnalyticsCharts } from '/static/js/dashboard/group/analytics.js';

  const stats = {{ stats | json | safe }};
  initAnalyticsCharts(stats)
    .catch((error) => console.error('Failed to initialize analytics charts:', error));
</script>
{# djlint:on #}
{# End initialize charts with server data #}
