{% import "macros/dashboard.html" as dashboard -%}

{# Page title #}
{{ dashboard::form_title(title = "Analytics",
description = "Community statistics and growth trends. Analytics are cached for a few minutes and may not display up to date information.") }}
{# End page title #}

{# Summary stat cards #}
<div class="grid grid-cols-2 xl:grid-cols-4 gap-4 mt-10">
  <button type="button"
          data-analytics-tab="groups"
          data-active="true"
          class="bg-white border border-stone-200 text-start rounded-lg p-5 cursor-pointer hover:bg-stone-50 hover:border-stone-300 data-[active=true]:border-primary-500 data-[active=true]:bg-primary-50/50 data-[active=true]:outline data-[active=true]:outline-2 data-[active=true]:outline-primary-200 data-[active=true]:outline-offset-0 relative [&_span.tab-peak]:hidden md:[&_span.tab-peak]:hidden md:data-[active=true]:[&_span.tab-peak]:block">
    <div class="text-sm text-stone-600">Groups</div>
    <div class="mt-2 text-3xl font-semibold text-stone-900">{{ stats.groups.total|num_fmt }}</div>
    <div class="mt-1 text-xs text-stone-500">Active, non-deleted groups</div>
    <span class="tab-peak absolute left-1/2 top-[calc(100%+2.25rem-1px)] -translate-x-1/2 w-0 h-0 border-l-[14px] border-r-[14px] border-t-0 border-b-[14px] border-l-transparent border-r-transparent border-b-stone-200"></span>
  </button>
  <button type="button"
          data-analytics-tab="members"
          data-active="false"
          class="bg-white border border-stone-200 text-start rounded-lg p-5 cursor-pointer hover:bg-stone-50 hover:border-stone-300 data-[active=true]:border-primary-500 data-[active=true]:bg-primary-50/50 data-[active=true]:outline data-[active=true]:outline-2 data-[active=true]:outline-primary-200 data-[active=true]:outline-offset-0 relative [&_span.tab-peak]:hidden md:[&_span.tab-peak]:hidden md:data-[active=true]:[&_span.tab-peak]:block">
    <div class="text-sm text-stone-600">Members</div>
    <div class="mt-2 text-3xl font-semibold text-stone-900">{{ stats.members.total|num_fmt }}</div>
    <div class="mt-1 text-xs text-stone-500">Members across all groups</div>
    <span class="tab-peak absolute left-1/2 top-[calc(100%+2.25rem-1px)] -translate-x-1/2 w-0 h-0 border-l-[14px] border-r-[14px] border-t-0 border-b-[14px] border-l-transparent border-r-transparent border-b-stone-200"></span>
  </button>
  <button type="button"
          data-analytics-tab="events"
          data-active="false"
          class="bg-white border border-stone-200 text-start rounded-lg p-5 cursor-pointer hover:bg-stone-50 hover:border-stone-300 data-[active=true]:border-primary-500 data-[active=true]:bg-primary-50/50 data-[active=true]:outline data-[active=true]:outline-2 data-[active=true]:outline-primary-200 data-[active=true]:outline-offset-0 relative [&_span.tab-peak]:hidden md:[&_span.tab-peak]:hidden md:data-[active=true]:[&_span.tab-peak]:block">
    <div class="text-sm text-stone-600">Events</div>
    <div class="mt-2 text-3xl font-semibold text-stone-900">{{ stats.events.total|num_fmt }}</div>
    <div class="mt-1 text-xs text-stone-500">Published, upcoming or past</div>
    <span class="tab-peak absolute left-1/2 top-[calc(100%+2.25rem-1px)] -translate-x-1/2 w-0 h-0 border-l-[14px] border-r-[14px] border-t-0 border-b-[14px] border-l-transparent border-r-transparent border-b-stone-200"></span>
  </button>
  <button type="button"
          data-analytics-tab="attendees"
          data-active="false"
          class="bg-white border border-stone-200 text-start rounded-lg p-5 cursor-pointer hover:bg-stone-50 hover:border-stone-300 data-[active=true]:border-primary-500 data-[active=true]:bg-primary-50/50 data-[active=true]:outline data-[active=true]:outline-2 data-[active=true]:outline-primary-200 data-[active=true]:outline-offset-0 relative [&_span.tab-peak]:hidden md:[&_span.tab-peak]:hidden md:data-[active=true]:[&_span.tab-peak]:block">
    <div class="text-sm text-stone-600">Attendees</div>
    <div class="mt-2 text-3xl font-semibold text-stone-900">{{ stats.attendees.total|num_fmt }}</div>
    <div class="mt-1 text-xs text-stone-500">RSVPs across all events</div>
    <span class="tab-peak absolute left-1/2 top-[calc(100%+2.25rem-1px)] -translate-x-1/2 w-0 h-0 border-l-[14px] border-r-[14px] border-t-0 border-b-[14px] border-l-transparent border-r-transparent border-b-stone-200"></span>
  </button>
</div>
{# End summary stat cards #}

<div class="hidden xl:block mt-12 border-t border-stone-200"></div>

{# Charts sections #}
<div class="space-y-14 mt-10">
  {# Groups section #}
  <div data-analytics-content="groups">
    {{ dashboard::form_title(title = "Groups") }}
    <div class="mt-8 space-y-8">
      <div>
        <div class="text-sm font-semibold text-stone-500">Total</div>
        <div class="mt-4 grid grid-cols-1 xl:grid-cols-2 gap-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-category-chart", data = stats.groups.total_by_category, class = "h-[300px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-region-chart", data = stats.groups.total_by_region, class = "h-[300px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Running total</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-running-chart", data = stats.groups.running_total, class = "h-[340px]", min_points = 1) -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-running-category-chart", data = stats.groups.running_total_by_category, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-running-region-chart", data = stats.groups.running_total_by_region, class = "h-[340px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Per month</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-monthly-chart", data = stats.groups.per_month, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-monthly-category-chart", data = stats.groups.per_month_by_category, class = "h-[360px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "groups-monthly-region-chart", data = stats.groups.per_month_by_region, class = "h-[360px]") -}}
          </div>
        </div>
      </div>
    </div>
  </div>
  {# End groups section #}

  {# Members section #}
  <div class="hidden" data-analytics-content="members">
    {{ dashboard::form_title(title = "Members") }}
    <div class="mt-8 space-y-8">
      <div>
        <div class="text-sm font-semibold text-stone-500">Total</div>
        <div class="mt-4 grid grid-cols-1 xl:grid-cols-2 gap-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-category-chart", data = stats.members.total_by_category, class = "h-[300px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-region-chart", data = stats.members.total_by_region, class = "h-[300px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Running total</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-running-chart", data = stats.members.running_total, class = "h-[340px]", min_points = 1) -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-running-category-chart", data = stats.members.running_total_by_category, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-running-region-chart", data = stats.members.running_total_by_region, class = "h-[340px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Per month</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-monthly-chart", data = stats.members.per_month, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-monthly-category-chart", data = stats.members.per_month_by_category, class = "h-[360px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "members-monthly-region-chart", data = stats.members.per_month_by_region, class = "h-[360px]") -}}
          </div>
        </div>
      </div>
    </div>
  </div>
  {# End members section #}

  {# Events section #}
  <div class="hidden" data-analytics-content="events">
    {{ dashboard::form_title(title = "Events") }}
    <div class="mt-8 space-y-8">
      <div>
        <div class="text-sm font-semibold text-stone-500">Total</div>
        <div class="mt-4 grid grid-cols-1 xl:grid-cols-2 gap-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-group-category-chart", data = stats.events.total_by_group_category, class = "h-[300px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-region-chart", data = stats.events.total_by_group_region, class = "h-[300px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6 xl:col-span-2">
            {{ dashboard::analytics_chart(chart_id = "events-category-chart", data = stats.events.total_by_event_category, class = "h-[300px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Running total</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-running-chart", data = stats.events.running_total, class = "h-[340px]", min_points = 1) -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-running-group-category-chart", data = stats.events.running_total_by_group_category, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-running-group-region-chart", data = stats.events.running_total_by_group_region, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-running-event-category-chart", data = stats.events.running_total_by_event_category, class = "h-[340px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Per month</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-monthly-chart", data = stats.events.per_month, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-monthly-group-category-chart", data = stats.events.per_month_by_group_category, class = "h-[360px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-monthly-group-region-chart", data = stats.events.per_month_by_group_region, class = "h-[360px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "events-monthly-event-category-chart", data = stats.events.per_month_by_event_category, class = "h-[360px]") -}}
          </div>
        </div>
      </div>
    </div>
  </div>
  {# End events section #}

  {# Attendees section #}
  <div class="hidden" data-analytics-content="attendees">
    {{ dashboard::form_title(title = "Attendees") }}
    <div class="mt-8 space-y-8">
      <div>
        <div class="text-sm font-semibold text-stone-500">Total</div>
        <div class="mt-4 grid grid-cols-1 xl:grid-cols-2 gap-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-category-chart", data = stats.attendees.total_by_event_category, class = "h-[300px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-region-chart", data = stats.attendees.total_by_group_region, class = "h-[300px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Running total</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-running-chart", data = stats.attendees.running_total, class = "h-[340px]", min_points = 1) -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-running-group-category-chart", data = stats.attendees.running_total_by_group_category, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-running-group-region-chart", data = stats.attendees.running_total_by_group_region, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-running-event-category-chart", data = stats.attendees.running_total_by_event_category, class = "h-[340px]") -}}
          </div>
        </div>
      </div>

      <div>
        <div class="text-sm font-semibold text-stone-500">Per month</div>
        <div class="mt-4 space-y-6">
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-monthly-chart", data = stats.attendees.per_month, class = "h-[340px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-monthly-group-category-chart", data = stats.attendees.per_month_by_group_category, class = "h-[360px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-monthly-group-region-chart", data = stats.attendees.per_month_by_group_region, class = "h-[360px]") -}}
          </div>
          <div class="bg-white border border-stone-200 rounded-lg p-6">
            {{ dashboard::analytics_chart(chart_id = "attendees-monthly-event-category-chart", data = stats.attendees.per_month_by_event_category, class = "h-[360px]") -}}
          </div>
        </div>
      </div>
    </div>
  </div>
  {# End attendees section #}
</div>
{# End charts sections #}

{# Initialize charts with server data #}
{# djlint:off #}
<script type="module">
  import { initAnalyticsCharts } from '/static/js/dashboard/community/analytics.js';

  const stats = {{ stats | json | safe }};
  initAnalyticsCharts(stats)
    .catch((error) => console.error('Failed to initialize analytics charts:', error));
</script>
{# djlint:on #}
{# End initialize charts with server data #}
