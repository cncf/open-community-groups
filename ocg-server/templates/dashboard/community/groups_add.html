{% import "macros/ui.html" as ui -%}
{% import "macros/dashboard.html" as dashboard -%}

{# Groups form -#}
<form id="groups-form"
      hx-post="/dashboard/community/groups/add"
      hx-ext="no-empty-vals"
      hx-target="#dashboard-content"
      hx-indicator="#dashboard-spinner, #community-groups-create-spinner"
      hx-disabled-elt="button[type=submit], #cancel-button">
  <div class="space-y-12">
    <div class="border-b border-stone-900/10 pb-12">
      {{ dashboard::form_title(title = "Group Details", description = "Please add as many details about this group as possible.") -}}

      <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 md:grid-cols-6 max-w-5xl">
        {# Group name -#}
        <div class="col-span-full lg:col-span-3">
          <label for="name" class="form-label">
            Name <span class="asterisk">*</span>
          </label>
          <div class="mt-2">
            <input type="text"
                   name="name"
                   id="name"
                   maxlength="{{ crate::validation::MAX_LEN_ENTITY_NAME }}"
                   class="input-primary"
                   autocomplete="off"
                   autocorrect="off"
                   autocapitalize="off"
                   spellcheck="false"
                   required>
          </div>
          <p class="form-legend">
            Display name of the group (e.g. Kubernetes Amsterdam). Max {{ crate::validation::MAX_LEN_ENTITY_NAME }} characters.
          </p>
        </div>
        {# End Group name -#}

        <div class="col-span-3"></div>

        {# Group category -#}
        <div class="col-span-full lg:col-span-3">
          <label for="category_id" class="form-label">
            Category <span class="asterisk">*</span>
          </label>
          <div class="mt-2 grid grid-cols-1">
            <select id="category_id" name="category_id" class="select-primary" required>
              <option value="">Select a category</option>
              {% for category in categories %}
                <option value="{{ category.group_category_id }}">{{ category.name }}</option>
              {% endfor %}
            </select>
          </div>
          <p class="form-legend">Type of group or event series.</p>
        </div>
        {# End Group category -#}

        {# Group region -#}
        <div class="col-span-full lg:col-span-3">
          <label for="region_id" class="form-label">Region</label>
          <div class="mt-2 grid grid-cols-1">
            <select id="region_id" name="region_id" class="select-primary">
              <option value="">Select a region (optional)</option>
              {% for region in regions %}<option value="{{ region.region_id }}">{{ region.name }}</option>{% endfor %}
            </select>
          </div>
          <p class="form-legend">Geographic region where the group is primarily based.</p>
        </div>
        {# End Group region -#}

        {# Short Description -#}
        <div class="col-span-full">
          <label for="description_short" class="form-label">Short Description</label>
          <div class="mt-2">
            <textarea id="description_short"
                      name="description_short"
                      rows="2"
                      class="input-primary"
                      maxlength="{{ crate::validation::MAX_LEN_DESCRIPTION_SHORT }}"></textarea>
          </div>
          <p class="form-legend">
            Brief description for group listings and previews. Max {{ crate::validation::MAX_LEN_DESCRIPTION_SHORT }} characters.
          </p>
        </div>
        {# End Short Description -#}

        {# Group Description -#}
        <div class="col-span-full">
          <label for="description" class="form-label">
            Description <span class="asterisk">*</span>
          </label>
          <div class="mt-2">
            <markdown-editor id="description" name="description" required></markdown-editor>
          </div>
          <p class="form-legend">Brief description of the group and its purpose.</p>
        </div>
        {# End Group Description -#}

        {# Logo URL -#}
        <div class="col-span-full lg:col-span-4">
          <image-field label="Logo" name="logo_url" image-kind="logo" target="logo" legend="If this is missing we'll display the community logo.">
        </image-field>
      </div>
      {# End Logo URL -#}

      {# Banner URL -#}
      <div class="col-span-full">
        <image-field label="Banner" name="banner_url" image-kind="banner" help-prefix-text="Size required 2428 x 192 px." target="banner" legend="If this is missing we'll display the community banner.">
      </image-field>
    </div>
    {# End Banner URL -#}

    {# Banner Mobile URL -#}
    <div class="col-span-full">
      <image-field label="Banner Mobile" name="banner_mobile_url" image-kind="banner" help-prefix-text="Size required 1220 x 192 px." target="banner_mobile" legend="If this is missing we'll display the community banner.">
    </image-field>
  </div>
  {# End Banner Mobile URL -#}
</div>
</div>

{# Location section -#}
<div class="border-b border-stone-900/10 pb-12">
  {{ dashboard::form_title(title = "Location",
    description = "Optional location information for the group.",
    button = "<button id='clear-location-fields'
          type='button'
          class='btn-primary-outline btn-mini whitespace-nowrap'
          aria-label='Clear location details'>Clear location</button>") -}}

  <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 md:grid-cols-6 max-w-5xl">
    {# Location search -#}
    <div class="col-span-full">
      <location-search-field id="group-location-search" placeholder-text="Search for a city..." venue-city-field-name="city" state-field-name="state" country-name-field-name="country_name" country-code-field-name="country_code" latitude-field-name="latitude" longitude-field-name="longitude" map-enabled>
      </location-search-field>
    </div>
    {# End Location search -#}
  </div>
</div>
{# End location section -#}

{# Social links section -#}
<div class="border-b border-stone-900/10 pb-12">
  {{ dashboard::form_title(title = "Social links", description = "Optional social media profiles and website links.") -}}

  <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 md:grid-cols-6 max-w-5xl">
    {# Website URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="website_url" class="form-label">Website</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-link bg-stone-300"></div>
        </div>
        <input type="url"
               name="website_url"
               id="website_url"
               class="input-primary ps-10"
               placeholder="https://example.com">
      </div>
    </div>
    {# End Website URL -#}

    {# Facebook URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="facebook_url" class="form-label">Facebook</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-facebook bg-stone-300"></div>
        </div>
        <input type="url"
               name="facebook_url"
               id="facebook_url"
               class="input-primary ps-10"
               placeholder="https://facebook.com/page">
      </div>
    </div>
    {# End Facebook URL -#}

    {# Flickr URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="flickr_url" class="form-label">Flickr</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-flickr bg-stone-300"></div>
        </div>
        <input type="url"
               name="flickr_url"
               id="flickr_url"
               class="input-primary ps-10"
               placeholder="https://flickr.com/photos/account">
      </div>
    </div>
    {# End Flickr URL -#}

    {# GitHub URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="github_url" class="form-label">GitHub</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-github bg-stone-300"></div>
        </div>
        <input type="url"
               name="github_url"
               id="github_url"
               class="input-primary ps-10"
               placeholder="https://github.com/organization">
      </div>
    </div>
    {# End GitHub URL -#}

    {# Instagram URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="instagram_url" class="form-label">Instagram</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-instagram bg-stone-300"></div>
        </div>
        <input type="url"
               name="instagram_url"
               id="instagram_url"
               class="input-primary ps-10"
               placeholder="https://instagram.com/username">
      </div>
    </div>
    {# End Instagram URL -#}

    {# LinkedIn URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="linkedin_url" class="form-label">LinkedIn</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-linkedin bg-stone-300"></div>
        </div>
        <input type="url"
               name="linkedin_url"
               id="linkedin_url"
               class="input-primary ps-10"
               placeholder="https://linkedin.com/company/name">
      </div>
    </div>
    {# End LinkedIn URL -#}

    {# Slack URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="slack_url" class="form-label">Slack</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-slack bg-stone-300"></div>
        </div>
        <input type="url"
               name="slack_url"
               id="slack_url"
               class="input-primary ps-10"
               placeholder="https://workspace.slack.com">
      </div>
    </div>
    {# End Slack URL -#}

    {# Twitter URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="twitter_url" class="form-label">X (formerly Twitter)</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-twitter bg-stone-300"></div>
        </div>
        <input type="url"
               name="twitter_url"
               id="twitter_url"
               class="input-primary ps-10"
               placeholder="https://x.com/username">
      </div>
    </div>
    {# End Twitter URL -#}

    {# WeChat URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="wechat_url" class="form-label">WeChat</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-wechat bg-stone-300"></div>
        </div>
        <input type="url"
               name="wechat_url"
               id="wechat_url"
               class="input-primary ps-10"
               placeholder="https://wechat.com/account">
      </div>
    </div>
    {# End WeChat URL -#}

    {# YouTube URL -#}
    <div class="col-span-full lg:col-span-3">
      <label for="youtube_url" class="form-label">YouTube</label>
      <div class="mt-2 relative">
        <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
          <div class="svg-icon size-4 icon-youtube bg-stone-300"></div>
        </div>
        <input type="url"
               name="youtube_url"
               id="youtube_url"
               class="input-primary ps-10"
               placeholder="https://youtube.com/channel/id">
      </div>
    </div>
    {# End YouTube URL -#}
  </div>
</div>
{# End social links section -#}

{# Additional content section -#}
<div class="pb-12">
  {{ dashboard::form_title(title = "Additional Content", description = "Optional tags, photos, and custom links.") -}}

  <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 md:grid-cols-6 max-w-5xl">
    {# Tags -#}
    <div class="col-span-3">
      <multiple-inputs field-name="tags" input-type="text" label="Tag">
      </multiple-inputs>
    </div>
    {# End Tags -#}

    {# Photo gallery -#}
    <div class="col-span-full">
      <gallery-field field-name="photos_urls" images="[]" max-images="0" label="Photos"></gallery-field>
      <p class="form-legend">Photos that will be displayed in the group gallery.</p>
    </div>
    {# End photo gallery -#}

    {# Extra links -#}
    <div class="col-span-full">
      <label class="form-label">Extra Links</label>
      <div class="mt-2">
        <key-value-inputs field-name="extra_links" key-placeholder="Link Name" value-placeholder="URL" items="{}" label="Link">
        </key-value-inputs>
      </div>
      <p class="form-legend">Additional custom links displayed in the group page.</p>
    </div>
    {# End extra links -#}
  </div>
</div>
{# End additional content section -#}

<div class="mt-6 flex items-center justify-end gap-x-6">
  {# Cancel button -#}
  <button id="cancel-button"
          type="button"
          hx-get="/dashboard/community?tab=groups"
          hx-target="body"
          hx-indicator="#dashboard-spinner"
          class="btn-primary-outline">Cancel</button>
  {# End cancel button -#}

  {# Save button -#}
  <button type="submit"  class="btn-primary relative">
    {{ ui::btn_spinner(id = "community-groups-create-spinner", spinner_type = "2") -}}
    Create Group
  </button>
  {# End save button -#}
</div>
</div>
</form>

<script type="module">
  import {
    handleHtmxResponse
  } from '/static/js/common/alerts.js';
  import '/static/js/common/location-search-field.js';

  const groupsForm = document.getElementById('groups-form');
  const cancelButton = document.getElementById('cancel-button');

  if (cancelButton) {
    cancelButton.addEventListener('htmx:afterRequest', () => {
      history.pushState({}, "Groups list", '/dashboard/community?tab=groups');
    });
  }

  if (groupsForm) {
    groupsForm.addEventListener('htmx:afterRequest', (e) => {
      if (e.detail.elt.id === 'groups-form') {
        const xhr = e.detail?.xhr;
        handleHtmxResponse({
          xhr,
          successMessage: 'You have successfully created the group.',
          errorMessage: 'Something went wrong creating the group. Please try again later.'
        });
      }
    });
  }

  const clearLocationButton = document.getElementById('clear-location-fields');
  const locationSearchField = document.querySelector('location-search-field');

  if (clearLocationButton && locationSearchField && typeof locationSearchField.clearLocationFields === 'function') {
    clearLocationButton.addEventListener('click', () => {
      locationSearchField.clearLocationFields();
    });
  }
</script>
{# End Groups form -#}
