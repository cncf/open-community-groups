{% extends "community/base.html" -%}

{% block content -%}
  <div class="container max-w-md m-auto px-4 py-8 md:px-6 md:py-12">
    <div class="bg-white p-8 md:p-10 border border-stone-200 rounded-lg shadow-sm">
      {# Header -#}
      <div class="mb-8 text-center">
        <h1 class="text-2xl font-bold text-stone-900 mb-2">Sign Up</h1>
        <p class="text-sm text-stone-600">Create your account</p>
      </div>
      {# End header -#}

      <div class="flex flex-col items-center space-y-4 mb-6">
        {# GitHub signup -#}
        {% if login.github -%}
          <div class="w-full">
            <a href="/log-in/oauth2/github{%- if let Some(next_url) = next_url -%}?next_url={{ next_url }}{%- endif -%}"
               class="group btn-primary-outline-anchor flex justify-center items-center space-x-3 w-full">
              <div class="svg-icon size-4 icon-github group-hover:bg-white transition-colors"></div>
              <span>GitHub</span>
            </a>
          </div>
        {% endif -%}
        {# End GitHub signup -#}

        {# Linux Foundation SSO signup -#}
        {% if login.linuxfoundation -%}
          <div class="w-full">
            <a href="/log-in/oidc/linuxfoundation{%- if let Some(next_url) = next_url -%}?next_url={{ next_url }}{%- endif -%}"
               class="group btn-primary-outline-anchor flex justify-center items-center space-x-3 w-full">
              <div class="svg-icon size-4 icon-lfx group-hover:bg-white transition-colors"></div>
              <span>Linux Foundation SSO</span>
            </a>
          </div>
        {% endif -%}
        {# End Linux Foundation SSO signup -#}
      </div>

      {# Email signup -#}
      {% if login.email -%}
        {% if login.linuxfoundation || login.github -%}
          <div class="inline-flex items-center justify-center w-full relative mb-6">
            <hr class="w-full h-px bg-stone-200 border-0">
            <div class="absolute px-3 bg-white text-xs text-stone-500 uppercase tracking-wide">OR</div>
          </div>
        {% endif -%}

        <form id="sign-up-form"
              action="/sign-up{%- if let Some(next_url) = next_url -%}?next_url={{ next_url }}{%- endif -%}"
              method="post">
          <div class="space-y-5">
            {# Name field -#}
            <div>
              <label for="name" class="block mb-2 text-sm font-medium text-stone-900">
                Full Name <span class="text-red-500">*</span>
              </label>
              <input id="name"
                     name="name"
                     type="text"
                     class="input-primary"
                     autocomplete="name"
                     autocorrect="off"
                     autocapitalize="words"
                     spellcheck="false"
                     required>
            </div>
            {# End name field -#}

            {# Email field -#}
            <div>
              <label for="email" class="block mb-2 text-sm font-medium text-stone-900">
                Email Address <span class="text-red-500">*</span>
              </label>
              <input id="email"
                     name="email"
                     type="email"
                     class="input-primary"
                     autocomplete="email"
                     required>
            </div>
            {# End email field -#}

            {# Username field -#}
            <div>
              <label for="username" class="block mb-2 text-sm font-medium text-stone-900">
                Username <span class="text-red-500">*</span>
              </label>
              <input id="username"
                     name="username"
                     type="text"
                     class="input-primary"
                     autocomplete="username"
                     autocorrect="off"
                     autocapitalize="off"
                     spellcheck="false"
                     required>
            </div>
            {# End username field -#}

            {# Password fields -#}
            <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
              {# Password field -#}
              <div>
                <label for="password" class="block mb-2 text-sm font-medium text-stone-900">
                  Password <span class="text-red-500">*</span>
                </label>
                <input type="password"
                       id="password"
                       name="password"
                       class="input-primary"
                       autocomplete="new-password"
                       required>
              </div>
              {# End password field -#}

              {# Confirm password field -#}
              <div>
                <label for="password_confirmation"
                       class="block mb-2 text-sm font-medium text-stone-900">
                  Confirm Password <span class="text-red-500">*</span>
                </label>
                <input type="password"
                       id="password_confirmation"
                       name="password_confirmation"
                       class="input-primary"
                       autocomplete="new-password"
                       required>
              </div>
              {# End confirm password field -#}
            </div>
            {# End password fields -#}

            {# Submit button -#}
            <button type="submit" class="btn-primary w-full">Create Account</button>
            {# End submit button -#}
          </div>
        </form>
      {% endif -%}
      {# End email signup -#}

      {# Log in link -#}
      <div class="mt-6 text-center text-sm text-stone-600">
        Already have an account?
        <a href="/log-in{%- if let Some(next_url) = next_url -%}?next_url={{ next_url }}{%- endif -%}"
           class="text-primary-500 hover:text-primary-700 font-medium transition-colors">Sign in</a>
      </div>
      {# End log in link -#}

      {# Messages -#}
      {% if !messages.is_empty() -%}
        <div class="mt-6">
          {% for message in messages -%}
            <div class="flex items-center p-4 mb-3 text-yellow-800 border border-yellow-600 rounded-lg bg-yellow-50">
              <div class="text-sm">{{ message }}</div>
            </div>
          {% endfor -%}
        </div>
      {% endif -%}
      {# End messages -#}
    </div>
  </div>

  {# JavaScript for password validation -#}
  <script type="module">
    const signupForm = document.getElementById('sign-up-form');
    const passwords = document.querySelectorAll('input[type="password"]');

    const validatePasswords = () => {
      const password = document.getElementById('password');
      const passwordConfirmation = document.getElementById('password_confirmation');

      if (password.value !== passwordConfirmation.value) {
        passwordConfirmation.setCustomValidity('Passwords do not match');
      } else {
        passwordConfirmation.setCustomValidity('');
      }
    };

    passwords.forEach((password) => {
      password.addEventListener('input', validatePasswords);
    });
  </script>
  {# End JavaScript for password validation -#}
{% endblock content -%}
