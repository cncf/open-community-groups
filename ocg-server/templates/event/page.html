{% extends "common/base.html" -%}
{% import "macros/ui.html" as ui -%}
{% import "macros/badges.html" as badges -%}
{% import "macros/maps.html" as maps -%}
{% import "macros/social.html" as social -%}

{% block scripts -%}
  <script type="module" src="/static/js/common/breadcrumb-nav.js"></script>
  <script type="module" src="/static/js/common/images-gallery.js"></script>
  <script type="module" src="/static/js/common/people-list.js"></script>
  <script type="module" src="/static/js/common/user-chip.js"></script>
  <script type="module" src="/static/js/common/user-info-modal.js"></script>
  <script type="module" src="/static/js/common/share-modal.js"></script>
{% endblock scripts -%}

{% block content -%}
  {% let has_social_links = event.meetup_url.is_some() -%}

  {# Breadcrumb -#}
  <breadcrumb-nav banner-url="{{ event.banner_url.as_ref().or(event.group.banner_url.as_ref()).unwrap_or(&event.community.banner_url) }}" banner-mobile-url="{{ event.banner_mobile_url.as_ref().or(event.group.banner_mobile_url.as_ref()).unwrap_or(&event.community.banner_mobile_url) }}" items='[{"label": "Home", "href": "/", "icon": "home"}, {"label": {{ event.community.display_name|json }}, "href": "/{{ event.community.name }}", "icon": "community"}, {"label": {{ event.group.name|json }}, "href": "/{{ event.community.name }}/group/{{ event.group.slug }}", "icon": "groups"}, {"label": {{ event.name|demoji|json }}, "icon": "date", "current": true}]'></breadcrumb-nav>
  {# End breadcrumb -#}

  <div class="relative container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8 pb-8 md:pb-10 lg:pb-16 flex grow h-full">
    <div class="bg-white border border-stone-200 rounded-lg flex flex-col w-full relative overflow-hidden">
      {# Sold out badge -#}
      {{ badges::sold_out_overlay(remaining_capacity = event.remaining_capacity, capacity = event.capacity, inner_classes = Some("top-[44px] md:top-[55px] right-[-12px] md:right-[-16px]") , orientation = "top-right") -}}
      {# End sold out badge -#}

      <div class="flex gap-y-6 sm:gap-y-8 lg:gap-y-12 flex-col px-4 sm:px-6 lg:px-10 py-4 sm:py-6 lg:py-10">
        {# Event header with name and group -#}
        <div>
          {# Main flex container for logo, name/group, and social networks -#}
          <div class="flex flex-1 flex-row items-stretch md:gap-6">
            {# Event logo -#}
            <div class="relative">
              {{ ui::logo(logo_url = event.logo_url, classes = "hidden md:block size-24 md:size-28", size = 112) -}}
            </div>
            {# End event logo -#}

            <div class="flex-1 flex flex-col justify-between">
              <div class="flex-1 flex justify-between">
                <div class="flex flex-col">
                  {# Group/Category legend -#}
                  <a href="/{{ event.community.name }}/group/{{ event.group.slug }}"
                     class="text-sm font-semibold tracking-wide uppercase text-stone-400 hover:underline lg:-mt-1 md:mb-0.5"
                     hx-boost="true"
                     hx-target="body">{{ event.group.name }}</a>
                  {# End group/category legend -#}

                  {# Event name: use smaller font size for long titles (>68 chars) -#}
                  {% if event.name.len() > 68 -%}
                    <h1 class="text-[0.95rem]/5 xl:text-[1.45rem]/[1.35] font-semibold text-stone-900 line-clamp-2 mt-2 md:mt-1 xl:mt-0">
                      {{ event.name|demoji }}
                    </h1>
                  {% else -%}
                    <h1 class="text-[1.05rem]/6 xl:text-[1.65rem]/[1.2] font-semibold text-stone-900 line-clamp-2 mt-2 md:mt-1 xl:mt-0">
                      {{ event.name|demoji }}
                    </h1>
                  {% endif -%}
                  {# End event name -#}
                </div>

                {# Event status and social networks -#}
                <div class="hidden md:flex flex-col items-end gap-2">
                  {# Event status badge -#}
                  {% if event.canceled -%}
                    {{ badges::event_badge(kind = event.kind, canceled = true, extra_styles = Some("px-2.5 py-0.5") ) -}}
                  {% endif -%}
                  {# End event status badge -#}

                  {# Social networks -#}
                  {% if has_social_links -%}
                    <div class="flex flex-wrap gap-2">
                      {% if let Some(meetup_url) = &event.meetup_url -%}
                        {{ social::social_link(url = meetup_url, icon_name = "meetup", platform_name = "Meetup") -}}
                      {% endif -%}
                    </div>
                  {% endif -%}
                  {# End social networks -#}
                </div>
                {# End event status and social networks -#}
              </div>

              <div class="mt-2 md:mt-auto flex flex-col md:flex-row md:items-end md:justify-between w-full">
                {# Event details and date -#}
                <div class="flex items-end gap-4 text-stone-600">
                  {% if let Some(capacity) = &event.capacity -%}
                    <div class="flex items-center">
                      <div class="svg-icon size-4 mr-2 bg-stone-600 icon-people"></div>
                      {% if event.is_past() -%}
                        {% if let Some(remaining_capacity) = &event.remaining_capacity -%}
                          <span class="text-sm">Attendees: {{ capacity - remaining_capacity }}</span>
                        {% else -%}
                          <span class="text-sm">Capacity: {{ capacity }}</span>
                        {% endif -%}
                      {% else -%}
                        <span class="text-sm">Capacity: {{ capacity }}</span>
                        {% if let Some(remaining_capacity) = &event.remaining_capacity %}
                          {% if *remaining_capacity > 0 %}
                            <span class="text-xs text-stone-500 ms-2">(Remaining: {{ remaining_capacity }})</span>
                          {% endif %}
                        {% endif %}
                      {% endif -%}
                    </div>
                  {% endif -%}
                  <div>{{ badges::event_badge(kind = event.kind, extra_styles = Some("mt-0.5 px-2.5 py-0.5") ) -}}</div>
                </div>
                {# End event details and date -#}

                {# Social networks (mobile only) -#}
                {% if has_social_links -%}
                  <div class="md:hidden mt-4 md:mb-0">
                    <div class="flex flex-wrap gap-2">
                      {% if let Some(meetup_url) = &event.meetup_url -%}
                        {{ social::social_link(url = meetup_url, icon_name = "meetup", platform_name = "Meetup") -}}
                      {% endif -%}
                    </div>
                  </div>
                {% endif -%}
                {# End social networks (mobile) -#}

                <div class="mt-4 md:mt-0 flex flex-row flex-wrap gap-4 items-end md:ml-auto">
                  {# Share button -#}
                  <share-modal title="{{ event.group.name }} · {{ event.name }}" url="/{{ event.community.name }}/group/{{ event.group.slug }}/event/{{ event.slug }}">
                  </share-modal>
                  {# End share button -#}

                  {# Attend button section -#}
                  {% include "event/attend_button.html" %}
                  {# End attend button section -#}
                </div>
              </div>
            </div>

          </div>
          {# End main flex container -#}

        </div>
        {# End event header -#}

        {# Event date and location -#}
        <div class="py-4">
          <div class="grid md:grid-cols-2 gap-5 sm:gap-8 md:gap-5 lg:gap-8">
            {# Event date -#}
            <div class="border border-stone-200 rounded-lg h-full bg-white">
              <div class="p-4 h-full flex flex-col">
                <div class="flex items-center justify-between mb-4 min-h-[25px]">
                  <div class="text-base/3 uppercase font-semibold text-stone-400">Event date</div>
                </div>
                <div class="rounded-lg border border-dashed border-stone-200 bg-white p-4 text-stone-400 min-h-[108px] grow">
                  {% if let Some(starts_at) = &event.starts_at -%}
                    {% let start_tz = starts_at.with_timezone(event.timezone) -%}
                    {% match &event.ends_at -%}
                    {% when Some with (ends_at) -%}
                    {% let end_tz = ends_at.with_timezone(event.timezone) -%}
                    {% if start_tz.date_naive() != end_tz.date_naive() -%}
                      {# Multi-day event: FROM → TO layout #}
                      <div class="flex items-start gap-8">
                        <div>
                          <div class="text-xs uppercase font-medium mb-0.5">From</div>
                          <div class="text-lg sm:text-xl xl:text-2xl font-semibold text-stone-800">
                            {{ start_tz.format("%b %e, %G") }}
                          </div>
                          <div class="mt-1 text-sm text-stone-600">{{ start_tz.format("%I:%M %p") }}</div>
                        </div>
                        <div class="text-stone-400 mt-6 xl:mt-7">→</div>
                        <div>
                          <div class="text-xs uppercase font-medium mb-0.5">To</div>
                          <div class="text-lg sm:text-xl xl:text-2xl font-semibold text-stone-800">
                            {{ end_tz.format("%b %e, %G") }}
                          </div>
                          <div class="mt-1 text-sm text-stone-600">{{ end_tz.format("%I:%M %p") }}</div>
                        </div>
                      </div>
                    {% else -%}
                      {# Single-day event with end time: show time range #}
                      <div class="text-lg sm:text-xl xl:text-3xl font-semibold text-stone-800">
                        {{ start_tz.format("%B %e, %G") }}
                      </div>
                      <div class="mt-2 text-base text-stone-600">
                        {{ start_tz.format("%I:%M %p") }} - {{ end_tz.format("%I:%M %p %Z") }}
                      </div>
                    {% endif -%}
                    {% when None -%}
                    {# Single-day event without end time #}
                    <div class="text-lg sm:text-xl xl:text-3xl font-semibold text-stone-800">
                      {{ start_tz.format("%B %e, %G") }}
                    </div>
                    <div class="mt-2 text-base text-stone-600">{{ start_tz.format("%I:%M %p %Z") }}</div>
                  {% endmatch -%}
                {% else -%}
                  <div class="text-lg sm:text-xl xl:text-3xl font-semibold text-stone-800">TBD</div>
                {% endif -%}
              </div>
            </div>
          </div>
          {# Location -#}
          <div class="border border-stone-200 rounded-lg p-4 bg-white">
            <div class="flex items-center justify-between mb-4 min-h-[25px]">
              <div class="text-base/3 uppercase font-semibold text-stone-400">Location</div>
            </div>
            <div class="relative rounded-lg border border-dashed border-stone-200 bg-white overflow-hidden grow min-h-[108px]">
              {% if event.kind != EventKind::Virtual %}
                {% if event.latitude.is_some() && event.longitude.is_some() %}
                  {# Use event-specific location #}
                  {% let location_text = self.event.location(70) -%}
                  {% let location_text_small = self.event.location(35) -%}
                  {{ maps::map_with_modal(base_id = "event", lat = event.latitude.unwrap() , lng = event.longitude.unwrap(), overlay_text = location_text, small_overlay_text = location_text_small, modal_title = event.name|demoji) -}}
                {% else -%}
                  {% let location_text = self.event.location(70) -%}
                  {% let location_text_small = self.event.location(35) -%}
                  {% if location_text.is_some() %}
                    <div class="relative h-full w-full">
                      <div class="absolute inset-0 bg-[url('/static/images/map.png')] bg-cover bg-center bg-no-repeat opacity-30">
                      </div>
                      {% if let Some(text) = &location_text %}
                        <div class="absolute bottom-2 left-2 bg-white/80 text-stone-700 text-xs rounded-full px-1.5 md:px-3 py-1 z-[1000] pointer-events-none hidden sm:block md:hidden xl:block">
                          {{ text }}
                        </div>
                      {% endif %}
                      {% if let Some(text) = &location_text_small %}
                        <div class="absolute bottom-2 left-2 bg-white/80 text-stone-700 text-xs rounded-full px-1.5 md:px-3 py-1 z-[1000] pointer-events-none block sm:hidden md:block xl:hidden">
                          {{ text }}
                        </div>
                      {% endif %}
                    </div>
                  {% else -%}
                    <div class="relative flex h-full w-full items-center justify-center p-4 text-center text-sm text-stone-500">
                      <div class="absolute inset-0 bg-[url('/static/images/map.png')] bg-cover bg-center bg-no-repeat opacity-30">
                      </div>
                      <div class="relative flex w-full items-center justify-center">
                        <div class="text-xl font-semibold text-stone-700 text-center">Location not provided</div>
                      </div>
                    </div>
                  {% endif -%}
                {% endif -%}
              {% else -%}
                <div class="relative flex h-full w-full items-center justify-center p-4 text-center text-sm text-stone-500">
                  <div class="absolute inset-0 bg-[url('/static/images/map.png')] bg-cover bg-center bg-no-repeat opacity-30">
                  </div>
                  <div class="relative flex w-full items-center justify-center">
                    <div class="text-xl font-semibold text-stone-700 text-center">Virtual event</div>
                  </div>
                </div>
              {% endif -%}
            </div>
          </div>

          {# End location -#}
        </div>
      </div>
      {# End event date and location -#}

      {# Event description -#}
      <div>
        <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-6 pb-6 lg:pt-2 lg:pb-14">
          About this event
        </div>
        <div class="text-stone-500 text-sm/6 markdown">{{ event.description|md_to_html|safe }}</div>
        {% if event.meeting_join_url.is_some() || event.meeting_recording_url.is_some() -%}
          {% let meeting_join_url = event.meeting_join_url -%}
          {% let meeting_recording_url = event.meeting_recording_url -%}
          {% let has_join = meeting_join_url.is_some() -%}
          {% let has_recording = meeting_recording_url.is_some() -%}
          <div data-meeting-details
               data-has-recording="{{ has_recording }}"
               class="hidden mt-6 sm:mt-8">
            <div class="border border-stone-200 bg-stone-50 rounded-lg p-4 sm:p-5">
              <div class="flex items-center gap-2 mb-3">
                <div class="svg-icon size-4 bg-stone-700 icon-meeting"></div>
                <div class="text-sm font-semibold uppercase tracking-wide text-stone-700">Meeting details</div>
              </div>
              <div class="text-sm text-stone-700 mb-4">
                {% if has_join && has_recording -%}
                  Use the links below to join the session or watch the recording.
                {% elif has_join -%}
                  Use the link below to join the session.
                {% else -%}
                  Use the link below to watch the recording.
                {% endif -%}
              </div>
              <div class="flex flex-wrap items-center gap-3">
                {% if let Some(meeting_join_url) = &meeting_join_url -%}
                  <div data-join-link-always>
                    <a href="{{ meeting_join_url }}"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="group btn-primary-outline-anchor h-10 md:h-[30px] flex items-center justify-center space-x-2">
                      <div class="svg-icon size-3 icon-meeting"></div>
                      <span>Meeting link</span>
                    </a>
                  </div>
                {% endif -%}
                {% if let Some(meeting_recording_url) = &meeting_recording_url -%}
                  <a href="{{ meeting_recording_url }}"
                     target="_blank"
                     rel="noopener noreferrer"
                     class="group btn-primary-outline-anchor h-10 md:h-[30px] flex items-center justify-center space-x-2">
                    <div class="svg-icon size-3 icon-recording"></div>
                    <span>View recording</span>
                  </a>
                {% endif -%}
              </div>
            </div>
          </div>
        {% endif -%}
      </div>
      {# End event description -#}

      {# Tags if available -#}
      {% if let Some(tags) = &event.tags -%}
        {% if !tags.is_empty() -%}
          <div>
            <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
              Tags
            </div>
            <div class="flex flex-wrap gap-2">
              {% for tag in tags -%}
                <span class="inline-block px-3 py-1 bg-stone-50 text-stone-700 text-sm rounded-full uppercase">{{ tag }}</span>
              {% endfor -%}
            </div>
          </div>
        {% endif -%}
      {% endif -%}
      {# End tags -#}

      {# Sessions section - Full width -#}
      {% if !event.sessions.is_empty() -%}
        {% let days_count = event.sessions.len() -%}
        <div>
          <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
            Agenda
          </div>

          {# Single-day agenda: no date title -#}
          {% if days_count == 1 -%}
            {% for day in event.sessions -%}
              <ol class="relative border-s border-stone-200">
                {% for session in day.1 %}{{ session_item(session = session, is_last = loop.last) -}}{% endfor %}
              </ol>
            {% endfor -%}
          {% else -%}
            {# Multi-day agenda: tabs with one day per tab -#}
            <ul class="flex flex-wrap space-x-2 -mb-px text-sm font-medium text-center border-b border-stone-200 -mt-1">
              {% for day in event.sessions -%}
                <li>
                  <button type="button"
                          data-day-tab="day-{{ loop.index0 }}"
                          data-active="{%- if loop.first -%}true{%- else -%}false{%- endif -%}"
                          class="cursor-pointer inline-flex items-center justify-center p-2 pt-0 sm:p-3 sm:pt-0 border-b-2 border-transparent rounded-t-lg hover:text-stone-600 hover:border-stone-300 data-[active=true]:text-primary-500 data-[active=true]:border-primary-500 text-nowrap">
                    <span class="hidden md:inline">{{ day.0.format("%A, %B %e") }}</span>
                    <span class="inline md:hidden">{{ day.0.format("%e %b") }}</span>
                  </button>
                </li>
              {% endfor -%}
            </ul>

            {% for day in event.sessions -%}
              <div data-day-content="day-{{ loop.index0 }}"
                   {% if !loop.first -%}
                     hidden
                   {% endif -%}
                   class="pt-10">
                <ol class="relative border-s border-stone-200">
                  {% for session in day.1 %}{{ session_item(session = session, is_last = loop.last) -}}{% endfor %}
                </ol>
              </div>
            {% endfor -%}

            <script type="module">
              const dayTabs = document.querySelectorAll('[data-day-tab]');
              const dayPanels = document.querySelectorAll('[data-day-content]');
              dayTabs.forEach((btn) => {
                btn.addEventListener('click', () => {
                  const target = btn.getAttribute('data-day-tab');
                  dayTabs.forEach(b => b.setAttribute('data-active', b === btn ? 'true' : 'false'));
                  dayPanels.forEach(panel => {
                    const isTarget = panel.getAttribute('data-day-content') === target;
                    panel.toggleAttribute('hidden', !isTarget);
                  });
                });
              });
            </script>
          {% endif -%}
        </div>
      {% endif -%}
      {# End sessions section -#}

      {# Hosts section (legacy data) - Full width -#}
      {% if let Some(legacy_hosts) = &event.legacy_hosts -%}
        {% if !legacy_hosts.is_empty() -%}
          <div>
            <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
              Hosts
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {% for host in legacy_hosts -%}
                {% if host.name.is_some() -%}
                  <user-chip user='{{ host|json }}'></user-chip>
                {% endif -%}
              {% endfor -%}
            </div>
          </div>
        {% endif -%}
      {% endif -%}
      {# End hosts section (legacy data) -#}

      {# Hosts section - Full width -#}
      {% if !event.hosts.is_empty() -%}
        <div>
          <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
            Hosts
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for host in event.hosts -%}
              {% if host.name.is_some() -%}
                <user-chip user='{{ host|json }}'></user-chip>
              {% endif -%}
            {% endfor -%}
          </div>
        </div>
      {% endif -%}
      {# End hosts section -#}

      {# Event speakers section - Full width -#}
      {% if !event.speakers.is_empty() -%}
        <div>
          <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
            Featured speakers
          </div>
          <div class="featured-speakers-grid grid grid-cols-1 md:grid-cols-2 gap-4">
            {% for speaker in event.speakers -%}
              {% if speaker.featured && speaker.user.name.is_some() -%}
                <user-chip user='{{ speaker.user|json }}' featured></user-chip>
              {% endif -%}
            {% endfor -%}
          </div>
        </div>

        <div>
          <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
            Speakers
          </div>
          <div class="regular-speakers-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for speaker in event.speakers -%}
              {% if !speaker.featured && speaker.user.name.is_some() -%}
                <user-chip user='{{ speaker.user|json }}'></user-chip>
              {% endif -%}
            {% endfor -%}
          </div>
        </div>
      {% endif -%}
      {# End event speakers section -#}

      {# Speakers section (legacy data) - Full width - no featured on LegacyUser -#}
      {% if let Some(legacy_speakers) = &event.legacy_speakers -%}
        {% if !legacy_speakers.is_empty() -%}
          <div>
            <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
              Speakers
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {% for speaker in legacy_speakers -%}
                {% if speaker.name.is_some() -%}
                  <user-chip user='{{ speaker|json }}' bio-is-html></user-chip>
                {% endif -%}
              {% endfor -%}
            </div>
          </div>
        {% endif -%}
      {% endif -%}
      {# End speakers section (legacy data) -#}

      {# Organizers section - Full width -#}
      {% if !event.organizers.is_empty() -%}
        <div>
          <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
            Organizers
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for organizer in event.organizers -%}
              {% if organizer.name.is_some() -%}
                <user-chip user='{{ organizer|json }}'></user-chip>
              {% endif -%}
            {% endfor -%}
          </div>
        </div>
      {% endif -%}
      {# End organizers section -#}

      {# Sponsors section - Full width -#}
      {% if !event.sponsors.is_empty() -%}
        <div>
          <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
            Sponsors
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for sponsor in event.sponsors -%}
              {{ badges::sponsor_badge(name = sponsor.name, logo_url = sponsor.logo_url, website_url = sponsor.website_url, level = sponsor.level, with_level = true) -}}
            {% endfor -%}
          </div>
        </div>
      {% endif -%}
      {# End sponsors section -#}

      {# Gallery -#}
      {% if let Some(photos_urls) = &event.photos_urls -%}
        {% if !photos_urls.is_empty() -%}
          <div>
            <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10 pb-8 lg:pt-2 lg:pb-14">
              Gallery
            </div>
            <images-gallery title="Gallery" altImage="Event {{ event.name }}" images="{{ photos_urls|json }}"></images-gallery>
          </div>
        {% endif -%}
      {% endif -%}
      {# End gallery -#}
    </div>
  </div>
</div>

{# User info modal -#}
<user-info-modal></user-info-modal>
{% endblock content -%}

{# Macro for rendering a single host social link -#}
{% macro host_social_link(url, label, icon) -%}
  <a href="{{ url }}"
     target="_blank"
     rel="noopener noreferrer"
     class="group p-1.5 bg-stone-100 hover:bg-primary-500 rounded-full transition-colors"
     aria-label="{{ label }}">
    <div class="svg-icon size-3 bg-stone-600 group-hover:bg-white icon-{{ icon }}"></div>
  </a>
{% endmacro -%}
{# End macro for rendering a single host social link -#}

{# Macro for rendering a single session item -#}
{% macro session_item(session, is_last = false) -%}
  <li class="{% if !is_last %}mb-5 {% endif %}ms-4">
    <div class="absolute size-3 bg-stone-300 rounded-full mt-1 -start-1.5 border border-white"></div>
    <div class="mb-2 text-sm text-stone-500/75">
      {% if let Some(ends_at) = &session.ends_at -%}
        {{ session.starts_at.with_timezone(event.timezone).format("%l:%M %p") }} - {{ ends_at.with_timezone(event.timezone).format("%l:%M %p %Z") }}
      {% else -%}
        {{ session.starts_at.with_timezone(event.timezone).format("%l:%M %p %Z") }}
      {% endif -%}
    </div>
    <div class="flex flex-col sm:flex-row items-start gap-2">
      <h3 class="md:text-lg font-semibold text-stone-900">{{ session.name|demoji }}</h3>
      {{ badges::event_badge(kind = session.kind, extra_styles = Some("mt-1 md:mt-1.5") ) -}}
    </div>
    {% if let Some(location) = &session.location -%}
      <div class="text-sm/6 text-stone-500 italic mb-3">{{ location }}</div>
    {% endif -%}
    {% if let Some(description) = &session.description -%}
      <div class="text-sm/6 text-stone-600 markdown mt-3">{{ description|md_to_html|safe }}</div>
    {% endif -%}
    {% if session.meeting_join_url.is_some() || session.meeting_recording_url.is_some() -%}
      {% let has_join = session.meeting_join_url.is_some() -%}
      {% let has_recording_session = session.meeting_recording_url.is_some() -%}
      <div data-meeting-details
           data-has-recording="{{ has_recording_session }}"
           class="hidden mt-3">
        <div class="flex flex-wrap items-center gap-3">
          {% if let Some(meeting_join_url) = &session.meeting_join_url -%}
            <a href="{{ meeting_join_url }}"
               data-join-link-always
               target="_blank"
               rel="noopener noreferrer"
               class="group btn-primary-outline inline-flex items-center gap-2 rounded-full h-10 sm:h-[30px] text-sm">
              <div class="svg-icon size-3 icon-meeting"></div>
              <span>Join session</span>
            </a>
          {% endif -%}
          {% if let Some(meeting_recording_url) = &session.meeting_recording_url -%}
            <a href="{{ meeting_recording_url }}"
               target="_blank"
               rel="noopener noreferrer"
               class="group btn-secondary-outline-anchor inline-flex items-center gap-2 rounded-full h-10 sm:h-[30px] text-sm">
              <div class="svg-icon size-3 icon-recording"></div>
              <span>View recording</span>
            </a>
          {% endif -%}
        </div>
      </div>
    {% endif -%}
    {% if !session.speakers.is_empty() -%}
      <div class="mt-4">
        <div class="text-xs font-semibold text-stone-500 mb-2">SPEAKERS</div>
        <div class="featured-sessions-grid grid gap-3">
          {% for speaker in session.speakers -%}
            {% if speaker.featured && speaker.user.name.is_some() -%}
              <user-chip user='{{ speaker.user|json }}' featured small></user-chip>
            {% endif -%}
          {% endfor -%}
        </div>
        <div class="regular-sessions-speakers flex flex-wrap gap-3">
          {% for speaker in session.speakers -%}
            {% if !speaker.featured && speaker.user.name.is_some() -%}
              <user-chip user='{{ speaker.user|json }}' small></user-chip>
            {% endif -%}
          {% endfor -%}
        </div>
      </div>
    {% endif -%}
  </li>
{% endmacro -%}
{# End macro for rendering a single session item -#}
