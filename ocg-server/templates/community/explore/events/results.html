{% import "common.html" as common -%}

{% let view_mode = self.view_mode.clone().unwrap_or_default() -%}

{% match view_mode -%}
{% when ViewMode::Calendar -%}
{# Calendar view -#}
<div class="mt-5 border-t border-gray-100 md:mt-7 p-5 md:p-7">
  <div class="flex justify-between items-center mb-8">
    <div id="calendar-date"
         class="text-xl font-semibold text-gray-600 md:text-2xl lg:text-[2rem]"></div>

    <div class="flex items-center">
      {# Loading spinner -#}
      <div id="loading-calendar" class="me-3 w-6 group">{% call common::small_spinner() -%}</div>
      {# End loading spinner -#}

      {# Today button -#}
      {% call common::secondary_mini_button(id = "current-month-btn", content = "Today", extra_styles = Some("h-[30px]")) -%}
      {# End today button -#}

      {# Next/Prev buttons -#}
      <div class="inline-flex ml-4" role="group">
        <button id="prev-month-btn"
                type="button"
                class="group cursor-pointer inline-flex items-center pr-4 pl-3 py-1 text-xs font-medium text-primary-500 bg-transparent border border-primary-500 rounded-s-full hover:bg-primary-500 hover:text-white focus:z-10 focus:ring-4 focus:ring-primary-300 focus:bg-primary-500 focus:text-white active:ring-4 active:ring-primary-300 active:bg-primary-500 active:text-white">
          <div class="svg-icon h-5 w-5 bg-primary-500 group-hover:bg-white group-focus:bg-white icon-arrow-left"></div>
        </button>
        <button id="next-month-btn"
                type="button"
                class="group cursor-pointer inline-flex items-center -ml-[1px] pl-4 pr-3 py-1 text-xs font-medium text-primary-500 bg-transparent border border-primary-500 rounded-e-full hover:bg-primary-500 hover:text-white focus:z-10 focus:ring-2 focus:ring-primary-300 focus:bg-primary-500 focus:text-white active:ring-4 active:ring-primary-300 active:bg-primary-500 active:text-white">
          <div class="svg-icon h-5 w-5 bg-primary-500 group-hover:bg-white group-focus:bg-white icon-arrow-right">
          </div>
        </button>
      </div>
      {# End next/prev buttons -#}
    </div>
  </div>

  <div class="relative">
    {# Placeholder calendar -#}
    {% if events.len() == 0 -%}
      <div class="absolute mt-10 z-[10]">
        {% call common::alert(title = "We're sorry!", content = "We can't seem to find any events that match your search criteria. You can reset your filters or try a different search.") -%}
      </div>
    {% endif -%}
    {# End placeholder calendar -#}
    <div id="calendar-box"
         class="min-h-[500px] fc fc-media-screen fc-direction-ltr fc-theme-standard
                {% if events.len() == 0 -%}opacity-30{%- endif %}">
      {# Main loading spinner -#}
      <div id="main-loading-calendar"
           role="status"
           class="absolute inset-0 flex items-center justify-center hidden">
        {% call common::main_loading() -%}
        <span class="sr-only">Loading...</span>
      </div>
      {# End main loading spinner -#}
    </div>
  </div>

</div>
{# djlint:off #}
<script type="module">
  import {
    Calendar
  } from '/static/js/community/explore/calendar.js';

  const calendar = new Calendar({ events: {{ events|json|safe }} });

  const currentMonthBtn = document.getElementById('current-month-btn');
  if (currentMonthBtn) {
    currentMonthBtn.addEventListener('click', () => {
      calendar.currentMonth()
      currentMonthBtn.blur();
    });
  }

  const prevMonthBtn = document.getElementById('prev-month-btn');
  if (prevMonthBtn) {
    prevMonthBtn.addEventListener('click', () => {
      calendar.previousMonth();
      prevMonthBtn.blur();
    });
  }

  const nextMonthBtn = document.getElementById('next-month-btn');
  if (nextMonthBtn) {
    nextMonthBtn.addEventListener('click', () => {
      calendar.nextMonth();
      nextMonthBtn.blur();
    });
  }
</script>
{# djlint:on #}
{# End calendar view -#}

{% when ViewMode::List -%}
{# List view -#}
<div class="flex flex-col divide-y mt-5 border-t border-gray-100 md:mt-7
            {% if events.len() > 0 %}border-b{% endif %}">
  {# Placeholder cards -#}
  {% if events.len() == 0 -%}
    {% call common::alert(title = "We're sorry!", content = "We can't seem to find any events that match your search criteria. You can reset your filters or try a different search.") -%}
  {% endif -%}
  {# End placeholder cards -#}

  {# Cards -#}
  {% for event in events %}{{ event|safe }}{% endfor %}
  {# End cards -#}
</div>

{# Pagination -#}
{% if events.len() > 0 %}{{ navigation_links|safe }}{% endif %}
{# End pagination -#}

<script type="module">
  import {
    updateResults
  } from '/static/js/community/explore/explore.js';

  updateResults('{% call common::current_page(total, events.len(), offset) %}');
</script>
{# End list view -#}

{% when ViewMode::Map -%}
{# Map view -#}
<div class="mt-5 border-t border-gray-100 md:mt-7 p-5 md:p-7">
  <div class="relative w-full border h-[600px] md:h-[820px] overflow-hidden">
    {# Loading spinner -#}
    <div id="loading-map" class="absolute top-3 start-3 w-6 z-[450] group">
      {% call common::small_spinner() -%}
    </div>
    {# End loading spinner -#}

    {# Placeholder map -#}
    {% if events.len() == 0 -%}
      <div class="absolute mt-10 z-[425]">
        {% call common::alert(title = "We're sorry!", content = "We can't seem to find any events that match your search criteria. You can reset your filters or try a different search.") -%}
      </div>
    {% endif -%}
    {# End placeholder map -#}

    <div id="map-box"
         class="relative w-full h-full leaflet-container leaflet-touch leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom
                {% if events.len() == 0 -%}opacity-30{%- endif %}">
      {# Main loading spinner -#}
      <div id="main-loading-map"
           role="status"
           class="absolute inset-0 flex items-center justify-center hidden">
        {% call common::main_loading() -%}
        <span class="sr-only">Loading...</span>
      </div>
      {# End main loading spinner -#}
    </div>
  </div>
</div>

{# djlint:off #}
<script type="module">
  import {
    Map
  } from '/static/js/community/explore/map.js';

  const map = new Map('events', { events: {{ events|json|safe }}, bbox: {{ bbox|json|safe }} });
</script>
{# djlint:on #}
{# End map view -#}

{% endmatch -%}
