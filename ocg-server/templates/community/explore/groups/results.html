{% import "common.html" as common -%}

{% let view_mode = self.view_mode.clone().unwrap_or_default() -%}

{% match view_mode -%}
{% when ViewMode::List -%}
{# List view -#}
<div class="flex flex-col divide-y divide-gray-100 mt-5 border-t border-gray-100 md:mt-7
            {% if groups.len() > 0 %}border-b{% endif %}">
  {# Placeholder cards -#}
  {% if groups.len() == 0 -%}
    {% call common::alert(title = "We're sorry!", content = "We can't seem to find any groups that match your search criteria. You can reset your filters or try a different search.") -%}
  {% endif -%}
  {# End placeholder cards -#}

  {# Cards -#}
  {% for group in groups -%}
    {{ group|safe }}
  {% endfor -%}
  {# End cards -#}
</div>

{# Pagination -#}
{% if groups.len() > 0 -%}
  {{ navigation_links|safe }}
{% endif -%}
{# End pagination -#}

<script type="module">
  import {
    updateResults
  } from '/static/js/community/explore/explore.js';

  updateResults('{% call common::current_page(total, groups.len(), offset) %}');
</script>
{# End list view -#}

{% when ViewMode::Map -%}
{# Map view -#}
<div class="mt-5 border-t border-gray-100 md:mt-7 p-5 md:p-7">
  <div class="relative w-full border border-gray-200 h-[600px] md:h-[820px] overflow-hidden">
    {# Loading spinner -#}
    <div id="loading-map" class="absolute top-3 start-3 w-6 z-[450] group">
      {% call common::small_spinner() -%}
    </div>
    {# End loading spinner -#}

    {# Placeholder map -#}
    {% if groups.len() == 0 -%}
      <div class="absolute mt-10 z-[425]">
        {% call common::alert(title = "We're sorry!", content = "We can't seem to find any events that match your search criteria. You can reset your filters or try a different search.") -%}
      </div>
    {% endif -%}
    {# End placeholder map -#}
    <div id="map-box"
         class="relative w-full h-full leaflet-container leaflet-touch leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom
                {% if groups.len() == 0 -%}opacity-30{%- endif %}">
      {# Main loading spinner -#}
      <div id="main-loading-map"
           role="status"
           class="absolute inset-0 flex items-center justify-center hidden">
        {% call common::main_loading() -%}
        <span class="sr-only">Loading...</span>
      </div>
      {# End main loading spinner -#}
    </div>
  </div>
</div>

{# djlint:off #}
<script type="module">
  import {
    Map
  } from '/static/js/community/explore/map.js';

  const map = new Map('groups', { groups: {{ groups|json|safe }}, bbox: {{ bbox|json|safe }} });
</script>
{# djlint:on #}
{# End map view -#}

{% when _ -%}
{% endmatch -%}
