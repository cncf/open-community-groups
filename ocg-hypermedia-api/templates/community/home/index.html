{% import "common.html" as common %}
{% extends "community/base.html" %}

{% block headerColor %}bg-gray-100{% endblock %}

{% block jumbotron %}
  <style>
    .jumbotron-description a {
      color: var(--ocg-primary);
      font-weight: 600;
    }
  </style>
  <div class="relative container mx-auto max-w-7xl px-4 pt-5 pb-10 sm:px-6 lg:px-8">
    <!-- Jumbotron -->
    <section>
      <div class="relative z-10 max-w-screen-xl pb-10 md:pb-20">
        <h1
          class="text-center mb-8 text-xl font-bold tracking-tight leading-none md:text-2xl lg:text-4xl xl:text-5xl"
        >
          {{community.title }}
        </h1>
        <div
          id=""
          class="mb-8 font-normal text-gray-600 jumbotron-description"
        >
          {{ community.description|safe }}
        </div>
        <div>
          {% call common::search_bar("Search groups and events", "", "", "w-[100%] lg:w-[50%]", "mb-6") %}
        </div>
        {% call common::primary_link("Explore all", "/explore", "", false) %}
      </div>
      <div class="absolute bottom-[-82px] right-0 h-full max-w-[90%] w-[380px] bg-right-bottom bg-no-repeat bg-contain bg-[url('https://www.cncf.io/wp-content/uploads/2024/03/phippy-family-2.png')] sm:w-[520px] md:w-[600px] lg:w-[710px] xl:w-[760px] sm:bottom-[-105px] md:bottom-[-120px] lg:bottom-[-145px] xl:bottom-[-155px]"></div>
    </section>
    <!-- End jumbotron -->
  </div>
{% endblock %}

{% block content %}
  <div class="container mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
    <div class="pt-4 md:pt-8">
      <!-- Events in-person -->
      {% call events_list("Upcoming in-person events", "/explore?entity=events&kind=in-person", upcoming_in_person_events) %}

      <!-- Events online -->
      {% call events_list("Upcoming virtual events", "/explore?entity=events&kind=virtual", upcoming_virtual_events) %}

      <!-- Banner -->
      {% if let Some(ad_banner_url) = community.ad_banner_url %}
        <div class="hidden pb-16 md:flex">
          {% if let Some(ad_banner_link_url) = community.ad_banner_link_url %}
            <a rel="noopener noreferrer" class="mx-auto my-8 border-4 border-gray-100 w-[75%]" href="{{ ad_banner_link_url }}" target="_blank" aria-label="Open external link">
              <img class="h-auto max-w-[100%]" src="{{ ad_banner_url }}" title="Kubecon 2024 NA">
            </a>
          {% else %}
            <div class="mx-auto my-8 border-4 border-gray-100 w-[75%]">
              <img class="h-auto max-w-[100%]" src="{{ ad_banner_url }}" title="Kubecon 2024 NA">
            </div>
          {% endif %}
        </div>
      {% endif %}
      <!-- End banner -->

      <!-- Recently added groups -->
      <div class="flex items-center justify-between mb-6">
        <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10">
          Recently added groups
        </div>
        <div class="hidden justify-self-end lg:flex">
          {% call common::secondary_link("See all groups", "/explore?entity=groups", "ms-4", false) %}
        </div>
      </div>
      <div class="my-10">
        <div class="grid-1 grid gap-8 md:gap-12 md:grid-cols-2 xl:grid-cols-3">
          {% for group in recently_added_groups %}
            {% call groups_list_item(group) %}
          {% endfor %}
        </div>
        <div class="block mt-10 lg:hidden lg:mt-0">
          {% call common::secondary_link("See all groups", "/explore?entity=groups", "", false) %}
        </div>
      </div>
      <!-- End recentry added groups -->
    </div>
  </div>

  {% include "community/home/gallery.html" %}
{% endblock %}

<!-- Events list -->
{% macro events_list(title, link, events) %}
  <div class="my-5 pb-5 sm:my-8">
    <div class="flex items-center justify-between mb-6">
      <!-- Title -->
      <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10">
        {{ title }}
      </div>
      <!-- End title -->

      <!-- See all events on desktop -->
      <div class="hidden justify-self-end lg:flex">
        {% call common::secondary_link("See all events", link, "ms-4", false) %}
      </div>
      <!-- End see all events on desktop -->
    </div>
    <div class="my-10">
      <!-- Cards list -->
      <div class="grid-1 grid gap-8 md:gap-12 md:grid-cols-2 xl:grid-cols-3">
        {% for event in events %}
          {% call events_list_item(event) %}
        {% endfor %}
      </div>
      <!-- End cards list -->

      <!-- See all events on mobile -->
      <div class="block mt-10 lg:hidden lg:mt-0">
        {% call common::secondary_link("See all events", link, "", false) %}
      </div>
      <!-- See all events on mobile -->
    </div>
  </div>
{% endmacro %}
<!-- End events list -->

<!-- Events list item -->
{% macro events_list_item(event) %}
  <div class="flex flex-1 flex-row items-center">
    <!-- Event icon -->
    <div
      class="h-24 min-w-24 lg:h-[120px] lg:min-w-[120px] my-auto bg-no-repeat bg-center bg-cover rounded-lg border"
      style="
        background-image: url({% if let Some(logo_url) = event.logo_url %}{{ logo_url }}{% else %}https://img.freepik.com/free-photo/people-taking-part-high-protocol-event_23-2150951233.jpg{% endif %});
      "
    ></div>
    <!-- End event icon -->

    <div class="min-w-0 pl-4 content-center h-full">
      <a class="flex flex-col justify-between w-full h-full cursor-pointer hover:no-underline" href="#">
        <div>
          <!-- Event group -->
          <div class="truncate leading-3">
            <span class="text-xs font-semibold tracking-wide text-gray-400 uppercase">{{ event.group_name }}</span>
          </div>
          <!-- End event group -->

          <!-- Event title -->
          <h2 class="font-semibold line-clamp-1 lg:line-clamp-2 lg:h-[48px] mb-2">{{ event.name }}</h2>
          <!-- End event title -->
        </div>

        <div>
          <!-- Event location -->
          {% if let Some(venue_city) = event.venue_city %}
            <div class="flex flex-row items-center leading-4 pt-1 lg:pt-2">
              <svg class="-mt-[2px] w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"></path></svg>
              <div class="truncate text-gray-700 text-xs uppercase">
                {{ venue_city }}{% if let Some(group_state) = event.group_state %}, {{ group_state }} {% endif %}
              </div>
            </div>
          {% else %}
            {% if let Some(group_city) = event.group_city %}
              <div class="flex flex-row items-center leading-4 pt-1 lg:pt-2">
                <svg class="-mt-[2px] w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"></path></svg>
                <div class="truncate text-gray-700 text-xs uppercase">
                  {{ group_city }}{% if let Some(group_state) = event.group_state %}, {{ group_state }} {% endif %}
                </div>
              </div>
            {% endif %}
          {% endif %}
          <!-- End event location -->

          <!-- Event date -->
          {% if let Some(starts_at) = event.starts_at %}
            <div class="flex flex-row items-center leading-4 pt-1">
              <svg class="-mt-[2px] w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M128 0c13.3 0 24 10.7 24 24V64H296V24c0-13.3 10.7-24 24-24s24 10.7 24 24V64h40c35.3 0 64 28.7 64 64v16 48V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V192 144 128C0 92.7 28.7 64 64 64h40V24c0-13.3 10.7-24 24-24zM400 192H48V448c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V192zM329 297L217 409c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47 95-95c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"></path></svg>
              <span class="text-gray-700 text-xs uppercase truncate">{{ starts_at.format("%B %d · %I:%M %p %Z") }}</span>
            </div>
          {% endif %}
          <!-- End event date -->
        </div>
      </a>
    </div>
  </div>
{% endmacro %}
<!-- End events list item -->

<!-- Groups list item -->
{% macro groups_list_item(group) %}
  <div class="flex flex-1 flex-row items-center">
    <!-- Group icon -->
    <div
      class="h-24 min-w-24 lg:h-[120px] lg:min-w-[120px] my-auto bg-no-repeat bg-center bg-cover rounded-lg border"
      style="
        background-image: url({% if let Some(logo_url) = group.logo_url %}{{ logo_url }}{% else %}https://img.freepik.com/free-photo/people-taking-part-high-protocol-event_23-2150951233.jpg{% endif %});
      "
    ></div>
    <!-- End group icon -->

    <div class="min-w-0 pl-4 content-center h-full">
      <a class="flex flex-col justify-between w-full h-full cursor-pointer hover:no-underline" href="#">
        <div>
          <!-- Category or region -->
          <div class="truncate leading-3">
            <span class="text-xs font-semibold tracking-wide text-gray-400 uppercase">
              {% if let Some(region_name) = group.region_name %}
                {{ region_name }}
              {% else %}
                {{ group.category_name }}
              {% endif %}
            </span>
          </div>
          <!-- End category or region -->

          <!-- Group title -->
          <h2 class="font-semibold line-clamp-1 lg:line-clamp-2 lg:h-[48px] mb-2">{{ group.name }}</h2>
          <!-- End group title -->
        </div>

        <!-- Group location -->
        {% if let Some(city) = group.city %}
          <div class="flex flex-row leading-4 pt-1 lg:pt-2">
            <svg class="mt-0.5 w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"></path></svg>
            <div class="truncate text-gray-700 text-xs uppercase">
              {{ city }}{% if let Some(state) = group.state %}, {{ state }} {% endif %}
              {% if let Some(country_name) = group.country_name %}
              <span>
                , {{ country_name }}
              </span>
              {% endif %}
            </div>
          </div>
        {% endif %}
        <!-- End group location -->

        <!-- Group creation date -->
        <div class="flex flex-row items-center leading-4 pt-1">
          <svg class="-mt-[2px] w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M128 0c13.3 0 24 10.7 24 24V64H296V24c0-13.3 10.7-24 24-24s24 10.7 24 24V64h40c35.3 0 64 28.7 64 64v16 48V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V192 144 128C0 92.7 28.7 64 64 64h40V24c0-13.3 10.7-24 24-24zM400 192H48V448c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V192zM329 297L217 409c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47 95-95c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"></path></svg>
          <span class="text-gray-700 text-xs uppercase truncate">{{ group.created_at.format("%B %d · %I:%M %p %Z") }}</span>
        </div>
        <!-- End group creation date -->
      </a>
    </div>
  </div>
{% endmacro %}
<!-- End groups list item -->
