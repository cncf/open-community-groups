{% import "common.html" as common %}
{% extends "community/base.html" %}

{% block headerColor %}bg-gray-100{% endblock %}

{% block jumbotron %}
  <style>
    .jumbotron-description a {
      color: var(--ocg-primary);
      font-weight: 600;
    }
  </style>
  <div class="relative container mx-auto max-w-7xl px-4 pt-5 pb-10 sm:px-6 lg:px-8">
    <!-- Jumbotron -->
    <section>
      <div class="relative z-10 max-w-screen-xl pb-10 md:pb-20">
        <h1
          class="text-center mb-8 text-xl font-bold tracking-tight leading-none md:text-2xl lg:text-4xl xl:text-5xl"
        >
          {{community.title }}
        </h1>
        <div
          id=""
          class="mb-8 font-normal text-gray-600 jumbotron-description"
        >
          {{ community.description|safe }}
        </div>
        <div>
          {% call common::search_bar("Search groups and events", "", "", "w-[100%] lg:w-[50%]", "mb-6", true) %}
        </div>
        {% call common::primary_link("Explore all", "/explore", "", false) %}
      </div>
      <div class="absolute bottom-[-82px] right-0 h-full max-w-[90%] w-[380px] bg-right-bottom bg-no-repeat bg-contain bg-[url('https://www.cncf.io/wp-content/uploads/2024/03/phippy-family-2.png')] sm:w-[520px] md:w-[600px] lg:w-[710px] xl:w-[760px] sm:bottom-[-105px] md:bottom-[-120px] lg:bottom-[-145px] xl:bottom-[-155px]"></div>
    </section>
    <!-- End jumbotron -->
  </div>
{% endblock %}

{% block content %}
  <div class="container mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
    <!-- Stats -->
    <div class="flex flex-col justify-around items-center border rounded-lg p-10 sm:mt-16 sm:mb-6 md:flex-row">
      <div>
        <div class="flex items-center justify-center">
          <div>
            <svg class="h-12 w-12 text-gray-400" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M72 88a56 56 0 1 1 112 0A56 56 0 1 1 72 88zM64 245.7C54 256.9 48 271.8 48 288s6 31.1 16 42.3V245.7zm144.4-49.3C178.7 222.7 160 261.2 160 304c0 34.3 12 65.8 32 90.5V416c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V389.2C26.2 371.2 0 332.7 0 288c0-61.9 50.1-112 112-112h32c24 0 46.2 7.5 64.4 20.3zM448 416V394.5c20-24.7 32-56.2 32-90.5c0-42.8-18.7-81.3-48.4-107.7C449.8 183.5 472 176 496 176h32c61.9 0 112 50.1 112 112c0 44.7-26.2 83.2-64 101.2V416c0 17.7-14.3 32-32 32H480c-17.7 0-32-14.3-32-32zm8-328a56 56 0 1 1 112 0A56 56 0 1 1 456 88zM576 245.7v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zM320 32a64 64 0 1 1 0 128 64 64 0 1 1 0-128zM240 304c0 16.2 6 31 16 42.3V261.7c-10 11.3-16 26.1-16 42.3zm144-42.3v84.7c10-11.3 16-26.1 16-42.3s-6-31.1-16-42.3zM448 304c0 44.7-26.2 83.2-64 101.2V448c0 17.7-14.3 32-32 32H288c-17.7 0-32-14.3-32-32V405.2c-37.8-18-64-56.5-64-101.2c0-61.9 50.1-112 112-112h32c61.9 0 112 50.1 112 112z"></path></svg>
          </div>
          <div class="ms-5">
            <div class="text-xs text-gray-500 font-medium uppercase">Groups</div>
            <div class="text-4xl font-semibold text-gray-900">{{ stats.groups }}</div>
          </div>
        </div>
      </div>

      <div class="hidden h-[50px] min-h-[1em] w-0.5 self-stretch bg-neutral-200 lg:inline-block"></div>

      <div>
        <div class="flex items-center justify-center">
          <div>
            <svg class="h-12 w-12 text-gray-400" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 256 256" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M228.25,63.07l-4.66-2.69a23.6,23.6,0,0,0,0-8.76l4.66-2.69a8,8,0,0,0-8-13.86l-4.67,2.7A23.92,23.92,0,0,0,208,33.38V28a8,8,0,0,0-16,0v5.38a23.92,23.92,0,0,0-7.58,4.39l-4.67-2.7a8,8,0,1,0-8,13.86l4.66,2.69a23.6,23.6,0,0,0,0,8.76l-4.66,2.69a8,8,0,0,0,4,14.93,7.92,7.92,0,0,0,4-1.07l4.67-2.7A23.92,23.92,0,0,0,192,78.62V84a8,8,0,0,0,16,0V78.62a23.92,23.92,0,0,0,7.58-4.39l4.67,2.7a7.92,7.92,0,0,0,4,1.07,8,8,0,0,0,4-14.93ZM200,64a8,8,0,1,1,8-8A8,8,0,0,1,200,64ZM128,76a44,44,0,1,1-44,44A44,44,0,0,1,128,76Zm102.56,34.68a103.92,103.92,0,1,1-85.24-85.24,8,8,0,0,1-2.64,15.78A88.07,88.07,0,0,0,40,128a87.62,87.62,0,0,0,22.24,58.41A79.71,79.71,0,0,1,84,165.1a4,4,0,0,1,4.83.32,59.81,59.81,0,0,0,78.27,0,4,4,0,0,1,4.84-.32,79.86,79.86,0,0,1,21.79,21.31A87.62,87.62,0,0,0,216,128a88.85,88.85,0,0,0-1.22-14.68,8,8,0,1,1,15.78-2.64Z"></path></svg>
          </div>
          <div class="ms-5">
            <div class="text-xs text-gray-500 font-medium uppercase">Members</div>
            <div class="text-4xl font-semibold text-gray-900">{{ stats.groups_members }}</div>
          </div>
        </div>
      </div>

      <div class="hidden h-[50px] min-h-[1em] w-0.5 self-stretch bg-neutral-200 lg:inline-block"></div>

      <div>
        <div class="flex items-center justify-center">
          <div>
            <svg class="h-12 w-12 text-gray-400" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M17 10H7v2h10v-2zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zm-5-5H7v2h7v-2z"></path></svg>
          </div>
          <div class="ms-5">
            <div class="text-xs text-gray-500 font-medium uppercase">Events</div>
            <div class="text-4xl font-semibold text-gray-900">{{ stats.events }}</div>
          </div>
        </div>
      </div>

      <div class="hidden h-[50px] min-h-[1em] w-0.5 self-stretch bg-neutral-200 lg:inline-block"></div>

      <div>
        <div class="flex items-center justify-center">
          <div>
            <svg class="h-12 w-12 text-gray-400" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M14 12h4v1.5h-4zM14 15h4v1.5h-4z"></path><path d="M20 7h-5V4c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zm-9 0V4h2v5h-2V7zm9 13H4V9h5c0 1.1.9 2 2 2h2c1.1 0 2-.9 2-2h5v11z"></path><circle cx="9" cy="13.5" r="1.5"></circle><path d="M11.08 16.18c-.64-.28-1.34-.43-2.08-.43s-1.44.15-2.08.43c-.56.24-.92.78-.92 1.39V18h6v-.43c0-.61-.36-1.15-.92-1.39z"></path></svg>
          </div>
          <div class="ms-5">
            <div class="text-xs text-gray-500 font-medium uppercase">Attendees</div>
            <div class="text-4xl font-semibold text-gray-900">{{ stats.events_attendees }}</div>
          </div>
        </div>
      </div>
    </div>
    <!-- End stats -->

    <div class="pt-4 md:pt-8">
      <!-- Events in-person -->
      {% call events_list("Upcoming in-person events", "/explore?entity=events&kind=in-person", upcoming_in_person_events) %}

      <!-- Events online -->
      {% call events_list("Upcoming virtual events", "/explore?entity=events&kind=virtual", upcoming_virtual_events) %}

      <!-- Banner -->
      {% if let Some(ad_banner_url) = community.ad_banner_url %}
        <div class="hidden pb-16 md:flex">
          {% if let Some(ad_banner_link_url) = community.ad_banner_link_url %}
            <a rel="noopener noreferrer" class="mx-auto my-8 border-4 border-gray-100 w-[75%]" href="{{ ad_banner_link_url }}" target="_blank" aria-label="Open external link">
              <img class="h-auto max-w-[100%]" src="{{ ad_banner_url }}" title="Kubecon 2024 NA">
            </a>
          {% else %}
            <div class="mx-auto my-8 border-4 border-gray-100 w-[75%]">
              <img class="h-auto max-w-[100%]" src="{{ ad_banner_url }}" title="Kubecon 2024 NA">
            </div>
          {% endif %}
        </div>
      {% endif %}
      <!-- End banner -->

      <!-- Recently added groups -->
      <div class="flex items-center justify-between mb-6">
        <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10">
          Recently added groups
        </div>
        <div class="hidden justify-self-end lg:flex">
          {% call common::secondary_link("See all groups", "/explore?entity=groups", "ms-4", false) %}
        </div>
      </div>
      <div class="my-10">
        <div class="grid-1 grid gap-8 md:gap-12 md:grid-cols-2 xl:grid-cols-3">
          {% for group in recently_added_groups %}
            {% call groups_list_item(group) %}
          {% endfor %}
        </div>
        <div class="block mt-10 lg:hidden lg:mt-0">
          {% call common::secondary_link("See all groups", "/explore?entity=groups", "", false) %}
        </div>
      </div>
      <!-- End recentry added groups -->
    </div>
  </div>

  {% include "community/home/gallery.html" %}
{% endblock %}

<!-- Events list -->
{% macro events_list(title, link, events) %}
  <div class="my-5 pb-5 sm:my-8">
    <div class="flex items-center justify-between mb-6">
      <!-- Title -->
      <div class="uppercase text-lg lg:text-2xl tracking-wide font-bold leading-10">
        {{ title }}
      </div>
      <!-- End title -->

      <!-- See all events on desktop -->
      <div class="hidden justify-self-end lg:flex">
        {% call common::secondary_link("See all events", link, "ms-4", false) %}
      </div>
      <!-- End see all events on desktop -->
    </div>
    <div class="my-10">
      <!-- Cards list -->
      <div class="grid-1 grid gap-8 md:gap-12 md:grid-cols-2 xl:grid-cols-3">
        {% for event in events %}
          {% call events_list_item(event) %}
        {% endfor %}
      </div>
      <!-- End cards list -->

      <!-- See all events on mobile -->
      <div class="block mt-10 lg:hidden lg:mt-0">
        {% call common::secondary_link("See all events", link, "", false) %}
      </div>
      <!-- See all events on mobile -->
    </div>
  </div>
{% endmacro %}
<!-- End events list -->

<!-- Events list item -->
{% macro events_list_item(event) %}
  <div class="flex flex-1 flex-row items-center">
    <div class="relative">
      <!-- Event icon -->
      {% call common::logo(event.logo_url, event.group_name, event.name, "md:h-[120px] md:min-w-[120px]", 120) %}
      <!-- End event icon -->
    </div>

    <div class="min-w-0 pl-4 content-center h-full">
      <a class="flex flex-col justify-between w-full h-full cursor-pointer hover:no-underline" href="#">
        <div>
          <!-- Event group -->
          <div class="truncate leading-3 text-gray-400">
            <span class="text-xs font-semibold tracking-wide uppercase">{{ event.group_name }}</span>
          </div>
          <!-- End event group -->

          <!-- Event title -->
          <div class="font-semibold line-clamp-1 text-[0.9rem] lg:line-clamp-2 lg:h-[43px] mb-2 mt-1">{{ event.name|demoji }}</div>
          <!-- End event title -->
        </div>

        <div>
          <!-- Event location -->
          <div class="flex flex-row items-center leading-4 pt-1 lg:pt-2">
            <svg class="-mt-[2px] w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"></path></svg>
            {% match event.kind %}
              {% when EventKind::InPerson %}
                {% if let Some(location) = event.location(25) %}
                  <div class="truncate text-gray-700 text-xs uppercase">{{ location }}</div>
                {% endif %}
              {% when EventKind::Hybrid %}
                {% if let Some(location) = event.location(16) %}
                  <div class="truncate text-gray-700 text-xs uppercase">{{ location }}</div>
                {% endif %}
                <span class="-mt-[1px] ms-2 border text-gray-500 text-[10px] text-nowrap uppercase font-medium px-1.5 rounded-full">{{ event.kind }}</span>
              {% else %}
                <span class="-mt-[1px] border text-gray-500 text-[10px] text-nowrap uppercase font-medium px-1.5 rounded-full">{{ event.kind }}</span>
            {% endmatch %}
          </div>
          <!-- End event location -->

          <!-- Event date -->
          {% if let Some(starts_at) = event.starts_at %}
            <div class="flex flex-row items-center leading-4 pt-1.5">
              <svg class="-mt-[2px] w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M128 0c13.3 0 24 10.7 24 24V64H296V24c0-13.3 10.7-24 24-24s24 10.7 24 24V64h40c35.3 0 64 28.7 64 64v16 48V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V192 144 128C0 92.7 28.7 64 64 64h40V24c0-13.3 10.7-24 24-24zM400 192H48V448c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V192zM329 297L217 409c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47 95-95c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"></path></svg>
              <span class="truncate text-gray-700 text-xs uppercase truncate">{{ starts_at.with_timezone(event.timezone).format("%B %e · %l:%M %p %Z") }}</span>
            </div>
          {% endif %}
          <!-- End event date -->
        </div>
      </a>
    </div>
  </div>
{% endmacro %}
<!-- End events list item -->

<!-- Groups list item -->
{% macro groups_list_item(group) %}
  <div class="flex flex-1 flex-row items-center">
    <!-- Group icon -->
    {% call common::logo(group.logo_url, group.name, group.name, "md:h-[120px] md:min-w-[120px]", 120) %}
    <!-- End group icon -->

    <div class="min-w-0 pl-4 content-center h-full">
      <a class="flex flex-col justify-between w-full h-full cursor-pointer hover:no-underline" href="#">
        <div>
          <!-- Category or region -->
          <div class="truncate leading-3 text-gray-400">
            <span class="text-xs font-semibold tracking-wide uppercase">
              {% if let Some(region_name) = group.region_name %}
                {{ region_name }}
              {% else %}
                {{ group.category_name }}
              {% endif %}
            </span>
          </div>
          <!-- End category or region -->

          <!-- Group title -->
          <div class="font-semibold line-clamp-1 text-[0.9rem] lg:line-clamp-2 lg:h-[43px] mb-2 mt-1">{{ group.name|demoji }}</div>
          <!-- End group title -->
        </div>

        <div>
          <!-- Group location -->
          {% if let Some(location) = group.location(25) %}
            <div class="flex flex-row leading-4 pt-1 lg:pt-2">
              <svg class="mt-0.5 w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"></path></svg>
              <div class="truncate text-gray-700 text-xs uppercase">{{ location }}</div>
            </div>
          {% endif %}
          <!-- End group location -->

          <!-- Group creation date -->
          <div class="flex flex-row items-center leading-4 pt-1.5">
            <svg class="-mt-[2px] w-3 h-3 me-2" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M128 0c13.3 0 24 10.7 24 24V64H296V24c0-13.3 10.7-24 24-24s24 10.7 24 24V64h40c35.3 0 64 28.7 64 64v16 48V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V192 144 128C0 92.7 28.7 64 64 64h40V24c0-13.3 10.7-24 24-24zM400 192H48V448c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V192zM329 297L217 409c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47 95-95c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"></path></svg>
            <span class="text-gray-700 text-xs uppercase truncate">{{ group.created_at.format("%B %e · %Y") }}</span>
          </div>
          <!-- End group creation date -->
        </div>
      </a>
    </div>
  </div>
{% endmacro %}
<!-- End groups list item -->
